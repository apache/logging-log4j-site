<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<!-- Generated by Apache Maven Doxia at Jul 10, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>
    Log4j 2 Web Applications - Apache Log4j 2</title>
		<link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css" />
		<link rel="stylesheet" href="../css/site.css" type="text/css" />
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/bootstrap.min.js"></script>
		<script type="text/javascript" src="../js/prettify.min.js"></script>
		<script type="text/javascript" src="../js/site.js"></script>
			<meta name="author" content="Nick Williams" />
		<meta name="Date-Revision-yyyymmdd" content="20130710" />
		<meta http-equiv="Content-Language" content="en" />
		
				</head>
	<body class="composite">
		<img class="logo-left" src="../images/ls-logo.jpg" alt="Apache logging services logo" />
		<img class="logo-right" src="../images/logo.jpg" alt="Apache log4j logo" />
		<div class="clear"></div>

		<div class="navbar">
			<div class="navbar-inner">
				<div class="container-fluid">
					<a class="brand" href="http://logging.apache.org/log4j/2.x/">Apache Log4j 2 &trade;</a>
						<ul class="nav">
						<li>
					
				
				<a href="http://wiki.apache.org/logging" class="external" target="_blank" title="Logging Wiki">Logging Wiki</a>
			</li>
					<li>
					
				
				<a href="http://www.apache.org/" class="external" target="_blank" title="Apache">Apache</a>
			</li>
					<li>
									<a href="../../../" title="Logging Services">Logging Services</a>
			</li>
					<li>
					
				
				<a href="https://analysis.apache.org/dashboard/index/org.apache.logging.log4j:log4j" class="external" target="_blank" title="Sonar">Sonar</a>
			</li>
		</ul>
				</div>
			</div>
		</div>

		<div class="container-fluid">
			<table class="layout-table">
				<tr>
					<td class="sidebar">
						<div class="well sidebar-nav">
										<ul class="nav nav-list">
		 											 <li class="nav-header"><i class="icon-home"></i>Apache Log4jâ„¢ 2</li>
																						<li class="none">
									<a href="../index.html" title="About">About</a>
					</li>
 																<li class="none">
									<a href="../download.html" title="Download">Download</a>
					</li>
 																<li class="none">
									<a href="../maven-artifacts.html" title="Maven and Ivy">Maven and Ivy</a>
					</li>
 																<li class="none">
									<a href="../build.html" title="Build">Build</a>
					</li>
 																<li class="none">
									<a href="../changelog.html" title="Changelog">Changelog</a>
					</li>
 								</ul>
			<ul class="nav nav-list">
		 											 <li class="nav-header"><i class="icon-book"></i>Manual</li>
																						<li class="none">
									<a href="../manual/index.html" title="Introduction">Introduction</a>
					</li>
 																<li class="none">
									<a href="../manual/architecture.html" title="Architecture">Architecture</a>
					</li>
 																<li class="none">
									<a href="../manual/migration.html" title="Log4j 1.x Migration">Log4j 1.x Migration</a>
					</li>
 																																																																													<li class="collapsed">
									<a href="../manual/api.html" title="API">API</a>
										</li>
 																																																																																																																																																					<li class="collapsed">
									<a href="../manual/configuration.html" title="Configuration">Configuration</a>
										</li>
 																																																														<li class="expanded active">
									<a href="../manual/webapp.html" title="Web Applications">Web Applications</a>
										<ul>
																			<li class="none">
									<a href="../manual/webapp.html#Servlet-3.0" title="Servlet 3.0 and Newer">Servlet 3.0 and Newer</a>
					</li>
 																				<li class="none">
									<a href="../manual/webapp.html#Servlet-2.5" title="Servlet 2.5">Servlet 2.5</a>
					</li>
 																				<li class="none">
									<a href="../manual/webapp.html#ContextParams" title="Context Parameters">Context Parameters</a>
					</li>
 										</ul>
							</li>
 																																																											<li class="collapsed">
									<a href="../manual/plugins.html" title="Plugins">Plugins</a>
										</li>
 																																																																																						<li class="collapsed">
									<a href="../manual/lookups.html" title="Lookups">Lookups</a>
										</li>
 																																																																																																																																																																																																											<li class="collapsed">
									<a href="../manual/appenders.html" title="Appenders">Appenders</a>
										</li>
 																																																																																															<li class="collapsed">
									<a href="../manual/layouts.html" title="Layouts">Layouts</a>
										</li>
 																																																																																																																										<li class="collapsed">
									<a href="../manual/filters.html" title="Filters">Filters</a>
										</li>
 																																																																																						<li class="collapsed">
									<a href="../manual/async.html" title="Async Loggers">Async Loggers</a>
										</li>
 																<li class="none">
									<a href="../manual/jmx.html" title="JMX">JMX</a>
					</li>
 																<li class="none">
									<a href="../manual/logsep.html" title="Logging Separation">Logging Separation</a>
					</li>
 																																																																																																																										<li class="collapsed">
									<a href="../manual/extending.html" title="Extending Log4j">Extending Log4j</a>
										</li>
 								</ul>
			<ul class="nav nav-list">
		 											 <li class="nav-header"><i class="icon-cog"></i>Components</li>
																						<li class="none">
									<a href="../log4j-api/index.html" title="API">API</a>
					</li>
 																<li class="none">
									<a href="../log4j-core/index.html" title="Implementation">Implementation</a>
					</li>
 																<li class="none">
									<a href="../log4j-jcl/index.html" title="Commons Logging Bridge">Commons Logging Bridge</a>
					</li>
 																<li class="none">
									<a href="../log4j-1.2-api/index.html" title="Log4j 1.2 API">Log4j 1.2 API</a>
					</li>
 																<li class="none">
									<a href="../log4j-slf4j-impl/index.html" title="SLF4J Binding">SLF4J Binding</a>
					</li>
 																<li class="none">
									<a href="../log4j-to-slf4j/index.html" title="Log4j 2 to SLF4J Adapter">Log4j 2 to SLF4J Adapter</a>
					</li>
 																<li class="none">
									<a href="../log4j-flume-ng/index.html" title="Apache Flume">Apache Flume</a>
					</li>
 																<li class="none">
									<a href="../log4j-taglib/index.html" title="Log4j Tag Library">Log4j Tag Library</a>
					</li>
 																<li class="none">
									<a href="../log4j-jmx-gui/index.html" title="Log4j JMX GUI">Log4j JMX GUI</a>
					</li>
 								</ul>
			<ul class="nav nav-list">
		 											 <li class="nav-header"><i class="icon-info-sign"></i>Project Information</li>
																						<li class="none">
									<a href="../dependencies.html" title="Dependencies">Dependencies</a>
					</li>
 																<li class="none">
									<a href="../dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a>
					</li>
 																<li class="none">
									<a href="../dependency-management.html" title="Dependency Management">Dependency Management</a>
					</li>
 																<li class="none">
									<a href="../team-list.html" title="Project Team">Project Team</a>
					</li>
 																<li class="none">
									<a href="../mail-lists.html" title="Mailing Lists">Mailing Lists</a>
					</li>
 																<li class="none">
									<a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a>
					</li>
 																<li class="none">
									<a href="../license.html" title="Project License">Project License</a>
					</li>
 																<li class="none">
									<a href="../source-repository.html" title="Source Repository">Source Repository</a>
					</li>
 																<li class="none">
									<a href="../project-summary.html" title="Project Summary">Project Summary</a>
					</li>
 								</ul>
			<ul class="nav nav-list">
		 											 <li class="nav-header"><i class="icon-cog"></i>Project Reports</li>
																						<li class="none">
									<a href="../changes-report.html" title="Changes Report">Changes Report</a>
					</li>
 																<li class="none">
									<a href="../jira-report.html" title="JIRA Report">JIRA Report</a>
					</li>
 																<li class="none">
									<a href="../surefire-report.html" title="Surefire Report">Surefire Report</a>
					</li>
 																<li class="none">
									<a href="../rat-report.html" title="RAT Report">RAT Report</a>
					</li>
 								</ul>
							</div>
						<div id="poweredBy">
															<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
				<img class="poweredBy" alt="Built by Maven" src="../images/maven-feather.png" />
			</a>
									</div>
					</td>
					<td class="content">
						<!-- Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

         http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License. -->
  
    <div class="section"><h2>Using Log4j 2 in Web Applications<a name="Using_Log4j_2_in_Web_Applications"></a></h2>
      <p>
        You must take particular care when using Log4j or any other logging framework within a Java EE web application.
        It's important for logging resources to be properly cleaned up (database connections closed, files closed, etc.)
        when the container shuts down or the web application is undeployed. Because of the nature of class loaders
        within web applications, Log4j resources cannot be cleaned up through normal means. Log4j must be &quot;started&quot; when
        the web application deploys and &quot;shut down&quot; when the web application undeploys. How this works varies depending
        on whether your application is a <a href="#Servlet-3.0">Servlet 3.0 or newer</a> or
        <a href="#Servlet-2.5">Servlet 2.5</a> web application.
      </p>
      <a name="Servlet-3.0"></a>
      <div class="section"><h3>Servlet 3.0 and Newer Web Applications<a name="Servlet_3.0_and_Newer_Web_Applications"></a></h3>
        <p>
          A Servlet 3.0 or newer web application is any <tt>&lt;web-app&gt;</tt> whose <tt>version</tt>
          attribute has a value of &quot;3.0&quot; or higher. Of course, the application must also be running in a compatible
          web container. Some examples are: Tomcat 7.0 and higher, GlassFish 3.0 and higher, JBoss 7.0 and higher,
          Oracle WebLogic 12c and higher, and IBM WebSphere 8.0 and higher.
        </p>
        <p>
          <b>The Short Story</b><br />
          Log4j 2 &quot;just works&quot; in Servlet 3.0 and newer web applications. It is capable of automatically starting when
          the application deploys and shutting down when the application undeploys.
        </p>
        <p>
          <b><i>Important Note!</i></b> For performance reasons, containers often ignore certain JARs and do not scan
          them for web-fragments and <tt>ServletContainerInitializer</tt>s. For example, Tomcat 7 &lt;7.0.42 ignores
          all JAR files named log4j*.jar, which prevents this feature from working. This has been fixed in
          Tomcat 7.0.43, Tomcat 8, and later. In Tomcat 7 &lt;7.0.42 you will need to change catalina.properties and
          remove &quot;log4j*.jar&quot; from the jarsToSkip property.
        </p>
        <p>
          <b>The Long Story</b><br />
          The Log4j 2 Core JAR file is a web-fragment configured to order before any other web fragments in your
          application. It contains a <tt>ServletContainerInitializer</tt>
          (<a href="../log4j-core/apidocs/org/apache/logging/log4j/core/web/Log4jServletContainerInitializer.html">Log4jServletContainerInitializer</a>) that the container automatically discovers and initializes. This adds
          the <a href="../log4j-core/apidocs/org/apache/logging/log4j/core/web/Log4jServletContextListener.html">Log4jServletContextListener</a> and
          <a href="../log4j-core/apidocs/org/apache/logging/log4j/core/web/Log4jServletFilter.html">Log4jServletFilter</a> to the <tt>ServletContext</tt>. These classes properly initialize
          and deinitialize the Log4j configuration.
        </p>
        <p>
          You can customize the behavior of the listener and filter using the <tt>log4jContextName</tt>,
          <tt>log4jConfiguration</tt>, and/or <tt>isLog4jContextSelectorNamed</tt> context parameters. Read more
          about this in the <a href="#ContextParams">Context Parameters</a> section below.
        </p>
      </div>
      <a name="Servlet-2.5"></a>
      <div class="section"><h3>Servlet 2.5 Web Applications<a name="Servlet_2.5_Web_Applications"></a></h3>
        <p>
          A Servlet 2.5 web application is any <tt>&lt;web-app&gt;</tt> whose <tt>version</tt> attribute has a
          value of &quot;2.5.&quot; Note that Log4j 2 does not support Servlet 2.4 and older web applications. The
          <tt>version</tt> attribute is the only thing that matters; even if the web application is running in a
          Servlet 3.0 or newer container, it is a Servlet 2.5 web application if the <tt>version</tt> attribute
          is &quot;2.5.&quot;
        </p>
        <p>
          If you are using Log4j in a Servlet 2.5 web application, you <i>must</i> configure the
          <a href="../log4j-core/apidocs/org/apache/logging/log4j/core/web/Log4jServletContextListener.html">Log4jServletContextListener</a> and
          <a href="../log4j-core/apidocs/org/apache/logging/log4j/core/web/Log4jServletFilter.html">Log4jServletFilter</a> in the deployment descriptor. The filter should match all requests of any type. The
          listener should be the very first listener defined in the deployment descriptor, and the filter should be the
          very first filter defined and mapped in the deployment descriptor. This is easily accomplished using the
          following <tt>web.xml</tt> code:
          </p><div class="prettyprint linenums"><pre>    &lt;listener&gt;
        &lt;listener-class&gt;org.apache.logging.log4j.core.web.Log4jServletContextListener&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;filter&gt;
        &lt;filter-name&gt;log4jServletFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.apache.logging.log4j.core.web.Log4jServletFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;log4jServletFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
        &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
        &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
        &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
    &lt;/filter-mapping&gt;</pre></div>
        
        <p>
          You can customize the behavior of the listener and filter using the <tt>log4jContextName</tt>,
          <tt>log4jConfiguration</tt>, and/or <tt>isLog4jContextSelectorNamed</tt> context parameters. Read more
          about this in the <a href="#ContextParams">Context Parameters</a> section below.
        </p>
      </div>
      <a name="ContextParams"></a>
      <div class="section"><h3>Context Parameters<a name="Context_Parameters"></a></h3>
        <p>
          By default, Log4j 2 uses the <tt>ServletContext</tt>'s context name as the <tt>LoggerContext</tt> name
          and uses the standard pattern for locating the Log4j configuration file. There are three context parameters
          that you can use to control this behavior. The first, <tt>isLog4jContextSelectorNamed</tt>, specifies
          whether the context should be selected using the
          <a href="../log4j-core/apidocs/org/apache/logging/log4j/core/selector/JNDIContextSelector.html">JNDIContextSelector</a>. If <tt>isLog4jContextSelectorNamed</tt> is not specified or is anything other
          than <tt>true</tt>, it is assumed to be <tt>false</tt>.
        </p>
        <p>
          If <tt>isLog4jContextSelectorNamed</tt> is <tt>true</tt>, <tt>log4jContextName</tt> must be
          specified; otherwise, the application will fail to start with an exception. <tt>log4jConfiguration</tt>
          <i>should</i> also be specified in this case, and must be a valid URI for the configuration; however, this
          parameter is not required.
        </p>
        <p>
          If <tt>isLog4jContextSelectorNamed</tt> is not <tt>true</tt>, <tt>log4jConfiguration</tt> may be a
          valid URI or a path to a file, or it may start with &quot;classpath:&quot; to denote a file that can be found on the
          classpath.
        </p>
        <p>
          When specifying these context parameters, you must specify them in the deployment descriptor
          (<tt>web.xml</tt>) even in a Servlet 3.0 or never application. If you add them to the
          <tt>ServletContext</tt> within a listener, Log4j will initialize before the context parameters are
          available and they will have no effect. Here are some sample uses of these context parameters.
        </p>
        <p>
          <b>Set the Logging Context Name to &quot;myApplication&quot;</b>
          </p><div class="prettyprint linenums"><pre>    &lt;context-param&gt;
        &lt;param-name&gt;log4jContextName&lt;/param-name&gt;
        &lt;param-value&gt;myApplication&lt;/param-value&gt;
    &lt;/context-param&gt;</pre></div>
        
        <p>
          <b>Set the Configuration Path/File/URI to &quot;/etc/myApp/myLogging.xml&quot;</b>
          </p><div class="prettyprint linenums"><pre>    &lt;context-param&gt;
        &lt;param-name&gt;log4jConfiguration&lt;/param-name&gt;
        &lt;param-value&gt;file:///etc/myApp/myLogging.xml&lt;/param-value&gt;
    &lt;/context-param&gt;</pre></div>
        
        <p>
          <b>Use the <tt>JNDIContextSelector</tt></b>
          </p><div class="prettyprint linenums"><pre>    &lt;context-param&gt;
        &lt;param-name&gt;isLog4jContextSelectorNamed&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;log4jContextName&lt;/param-name&gt;
        &lt;param-value&gt;appWithJndiSelector&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;log4jConfiguration&lt;/param-name&gt;
        &lt;param-value&gt;file://D:\conf\myLogging.xml&lt;/param-value&gt;
    &lt;/context-param&gt;</pre></div>
          Note that in this case you must also set the &quot;Log4jContextSelector&quot; system property to
          &quot;org.apache.logging.log4j.core.selector.JNDIContextSelector.&quot;
        
      </div>
    </div>
  


					</td>
				</tr>
			</table>
		</div>

		<div class="footer">
							<p>Copyright &copy; 1999-2013 <a class="external" href="http://www.apache.org">Apache Software Foundation</a>. All Rights Reserved.</p>
				<p>Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.</p>
				<p>Site powered by <a class="external" href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>. Icons from <a class="external" href="http://glyphicons.com/">Glyphicons Free</a>.</p>
			</div>
		</div>
	</body>
</html>
