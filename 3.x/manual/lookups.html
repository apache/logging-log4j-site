<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from target/generated-sources/site/asciidoc/manual/lookups.adoc at 2024-02-17
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Log4j &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://logging.apache.org" id="bannerLeft"><img src="../images/ls-logo.jpg"  alt=""/></a></div>
          <div class="pull-right"><a href="http://logging.apache.org/log4j/3.x" id="bannerRight"><img src="../images/logo.png"  alt=""/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-02-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.0.0-beta2</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://github.com/apache/logging-log4j2" class="externalLink" title="GitHub">GitHub</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://analysis.apache.org/dashboard/index/org.apache.logging.log4j:log4j" class="externalLink" title="Sonar">Sonar</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="../../../" title="Logging Services">Logging Services</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a></li>
      <li class="pull-right"><a href="https://cwiki.apache.org/confluence/display/LOGGING/Log4j" class="externalLink" title="Logging Wiki">Logging Wiki</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/home.png" alt="Apache Log4j™ 3.x" border="0"/> Apache Log4j™ 3.x</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="../javadoc.html" title="Javadoc"><span class="none"></span>Javadoc</a></li>
    <li><a href="../maven-artifacts.html" title="Maven, Ivy, Gradle Artifacts"><span class="icon-chevron-right"></span>Maven, Ivy, Gradle Artifacts</a></li>
    <li><a href="../runtime-dependencies.html" title="Runtime Dependencies"><span class="none"></span>Runtime Dependencies</a></li>
    <li><a href="../release-notes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="../faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="../performance.html" title="Performance"><span class="icon-chevron-right"></span>Performance</a></li>
    <li><a href="../articles.html" title="Articles and Tutorials"><span class="none"></span>Articles and Tutorials</a></li>
    <li><a href="../security.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../support.html" title="Support"><span class="none"></span>Support</a></li>
    <li><a href="../thanks.html" title="Thanks"><span class="none"></span>Thanks</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/pencil.png" alt="For Contributors" border="0"/> For Contributors</li>
    <li><a href="../guidelines.html" title="Guidelines"><span class="none"></span>Guidelines</a></li>
    <li><a href="../javastyle.html" title="Style Guide"><span class="none"></span>Style Guide</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/book.png" alt="Manual" border="0"/> Manual</li>
    <li><a href="../manual/index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../manual/architecture.html" title="Architecture"><span class="none"></span>Architecture</a></li>
    <li><a href="../manual/compatibility.html" title="Log4j 1.x Compatibility"><span class="none"></span>Log4j 1.x Compatibility</a></li>
    <li><a href="../manual/migration.html" title="Log4j 1.x Migration"><span class="none"></span>Log4j 1.x Migration</a></li>
    <li><a href="../manual/api.html" title="Java API"><span class="icon-chevron-right"></span>Java API</a></li>
    <li><a href="../manual/scala-api.html" title="Scala API"><span class="none"></span>Scala API</a></li>
    <li><a href="../manual/configuration.html" title="Configuration"><span class="icon-chevron-right"></span>Configuration</a></li>
    <li><a href="../manual/usage.html" title="Usage"><span class="icon-chevron-right"></span>Usage</a></li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Lookups</a>
     <ul class="nav nav-list">
      <li><a href="../manual/lookups.html#ContextMapLookup" title="Context Map"><span class="none"></span>Context Map</a></li>
      <li><a href="../manual/lookups.html#DateLookup" title="Date"><span class="none"></span>Date</a></li>
      <li><a href="../manual/lookups.html#DockerLookup" title="Docker"><span class="none"></span>Docker</a></li>
      <li><a href="../manual/lookups.html#EnvironmentLookup" title="Environment"><span class="none"></span>Environment</a></li>
      <li><a href="../manual/lookups.html#EventLookup" title="Event"><span class="none"></span>Event</a></li>
      <li><a href="../manual/lookups.html#JavaLookup" title="Java"><span class="none"></span>Java</a></li>
      <li><a href="../manual/lookups.html#JndiLookup" title="JNDI"><span class="none"></span>JNDI</a></li>
      <li><a href="../manual/lookups.html#JmxRuntimeInputArgumentsLookup" title="JVM Arguments"><span class="none"></span>JVM Arguments</a></li>
      <li><a href="../manual/lookups.html#KubernetesLookup" title="Kubernetes"><span class="none"></span>Kubernetes</a></li>
      <li><a href="../manual/lookups.html#Log4jConfigLookup" title="Log4j Config"><span class="none"></span>Log4j Config</a></li>
      <li><a href="../manual/lookups.html#LowerLookup" title="Lower"><span class="none"></span>Lower</a></li>
      <li><a href="../manual/lookups.html#AppMainArgsLookup" title="Main Arguments"><span class="none"></span>Main Arguments</a></li>
      <li><a href="../manual/lookups.html#MapLookup" title="Map"><span class="none"></span>Map</a></li>
      <li><a href="../manual/lookups.html#StructuredDataLookup" title="Structured Data"><span class="none"></span>Structured Data</a></li>
      <li><a href="../manual/lookups.html#SystemPropertiesLookup" title="System Properties"><span class="none"></span>System Properties</a></li>
      <li><a href="../manual/lookups.html#UpperLookup" title="Upper"><span class="none"></span>Upper</a></li>
     </ul></li>
    <li><a href="../manual/appenders.html" title="Appenders"><span class="icon-chevron-right"></span>Appenders</a></li>
    <li><a href="../manual/layouts.html" title="Layouts"><span class="icon-chevron-right"></span>Layouts</a></li>
    <li><a href="../manual/filters.html" title="Filters"><span class="icon-chevron-right"></span>Filters</a></li>
    <li><a href="../manual/async.html" title="Async Loggers"><span class="icon-chevron-right"></span>Async Loggers</a></li>
    <li><a href="../manual/garbagefree.html" title="Garbage-free Logging"><span class="icon-chevron-right"></span>Garbage-free Logging</a></li>
    <li><a href="../manual/jmx.html" title="JMX"><span class="none"></span>JMX</a></li>
    <li><a href="../manual/logsep.html" title="Logging Separation"><span class="none"></span>Logging Separation</a></li>
    <li><a href="../manual/extending.html" title="Extending Log4j"><span class="icon-chevron-right"></span>Extending Log4j</a></li>
    <li><a href="../manual/plugins.html" title="Plugins"><span class="icon-chevron-right"></span>Plugins</a></li>
    <li><a href="../manual/customconfig.html" title="Programmatic Log4j Configuration"><span class="icon-chevron-right"></span>Programmatic Log4j Configuration</a></li>
    <li><a href="../manual/customloglevels.html" title="Custom Log Levels"><span class="icon-chevron-right"></span>Custom Log Levels</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/tag.png" alt="Related Projects" border="0"/> Related Projects</li>
    <li><a href="http://logging.apache.org/log4j/scala/index.html" class="externalLink" title="Log4j-Scala"><span class="none"></span>Log4j-Scala</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/link.png" alt="Older Releases" border="0"/> Older Releases</li>
    <li><a href="http://logging.apache.org/log4j/1.2/" class="externalLink" title="Log4j 1.2 - End of Life"><span class="none"></span>Log4j 1.2 - End of Life</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.3/" class="externalLink" title="Log4j 2.3 - Java 6"><span class="none"></span>Log4j 2.3 - Java 6</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.12.1/" class="externalLink" title="Log4j 2.12.1 - Java 7"><span class="none"></span>Log4j 2.12.1 - Java 7</a></li>
    <li><a href="http://logging.apache.org/log4j/2.x/" class="externalLink" title="Log4j 2.x - Latest release for Java 8"><span class="none"></span>Log4j 2.x - Latest release for Java 8</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/layers.png" alt="Internal Components" border="0"/> Internal Components</li>
    <li><a href="../log4j-api.html" title="API"><span class="none"></span>API</a></li>
    <li><a href="../log4j-core.html" title="Implementation"><span class="none"></span>Implementation</a></li>
    <li><a href="../log4j-1.2-api.html" title="Log4j 1.2 API"><span class="none"></span>Log4j 1.2 API</a></li>
    <li><a href="../log4j-slf4j-impl.html" title="SLF4J Binding"><span class="none"></span>SLF4J Binding</a></li>
    <li><a href="../log4j-jul.html" title="JUL Adapter"><span class="none"></span>JUL Adapter</a></li>
    <li><a href="../log4j-jpl.html" title="JDK Platform Logger"><span class="none"></span>JDK Platform Logger</a></li>
    <li><a href="../log4j-to-slf4j.html" title="Log4j 2 to SLF4J Adapter"><span class="none"></span>Log4j 2 to SLF4J Adapter</a></li>
    <li><a href="../log4j-jdbc-dbcp2.html" title="JDBC Appender"><span class="none"></span>JDBC Appender</a></li>
    <li><a href="../log4j-flume-ng.html" title="Apache Flume Appender"><span class="none"></span>Apache Flume Appender</a></li>
    <li><a href="../log4j-mongodb4.html" title="MongoDB 4 appender"><span class="none"></span>MongoDB 4 appender</a></li>
    <li><a href="../log4j-iostreams.html" title="IO Streams"><span class="none"></span>IO Streams</a></li>
    <li><a href="../log4j-docker.html" title="Docker Support"><span class="none"></span>Docker Support</a></li>
    <li><a href="../log4j-kubernetes.html" title="Kubernetes Support"><span class="none"></span>Kubernetes Support</a></li>
    <li><a href="../log4j-spring-cloud-config-client.html" title="Spring Cloud Config Client"><span class="none"></span>Spring Cloud Config Client</a></li>
    <li><a href="../log4j-transform" title="Log4j Transformation Tools"><span class="none"></span>Log4j Transformation Tools</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/link.png" alt="External Components" border="0"/> External Components</li>
    <li><a href="../log4j/jakarta" title="Log4j Jakarta EE"><span class="none"></span>Log4j Jakarta EE</a></li>
    <li><a href="../log4j/jmx-gui" title="Log4j JMX GUI"><span class="none"></span>Log4j JMX GUI</a></li>
    <li><a href="../log4j/tools" title="Log4j Tools"><span class="none"></span>Log4j Tools</a></li>
    <li><a href="../log4j/transform" title="Log4j Transformation Tools"><span class="none"></span>Log4j Transformation Tools</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/info.png" alt="Project Information" border="0"/> Project Information</li>
    <li><a href="../team.html" title="Project Team"><span class="none"></span>Project Team</a></li>
    <li><a href="https://www.apache.org/licenses/LICENSE-2.0" class="externalLink" title="Project License"><span class="none"></span>Project License</a></li>
    <li><a href="https://github.com/apache/logging-log4j2/tree/main" class="externalLink" title="Source Repository"><span class="none"></span>Source Repository</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/layers.png" alt="Project Reports" border="0"/> Project Reports</li>
    <li><a href="../rat-report.html" title="RAT Report"><span class="none"></span>RAT Report</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Lookups</h1>
<div id="preamble">
<div class="sectionbody">
<link rel="stylesheet" type="text/css" href="../css/tables.css">
<div class="paragraph">
<p>Lookups provide a way to add values to the Log4j configuration at
arbitrary places. They are a particular type of Plugin that implements
the
<a href="../log4j-core/apidocs/org/apache/logging/log4j/core/lookup/StrLookup.html"><code>StrLookup</code></a>
interface. Information on how to use Lookups in configuration files can
be found in the <a href="configuration.html#PropertySubstitution">Property
Substitution</a> section of the <a href="configuration.html">Configuration</a>
page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ContextMapLookup">Context Map Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ContextMapLookup allows applications to store data in the Log4j
ThreadContext Map and then retrieve the values in the Log4j
configuration. In the example below, the application would store the
current user&#8217;s login id in the ThreadContext Map with the key "loginId".
During initial configuration processing the first '$' will be removed.
The PatternLayout supports interpolation with Lookups and will then
resolve the variable for each event. Note that the pattern
"%X{loginId}" would achieve the same result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] $${ctx:loginId} %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="DateLookup">Date Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DateLookup is somewhat unusual from the other lookups as it doesn&#8217;t
use the key to locate an item. Instead, the key can be used to specify a
date format string that is valid for
<a href="http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</a>.
The current date, or the date associated with the current log event will
be formatted as specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;RollingFile name="Rolling-${map:type}" fileName="${filename}" filePattern="target/rolling1/test1-$${date:MM-dd-yyyy}.%i.log.gz"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
  &lt;SizeBasedTriggeringPolicy size="500" /&gt;
&lt;/RollingFile&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="DockerLookup">Docker Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DockerLookup can be used to lookup attributes from the Docker container the application is running in.</p>
</div>
<div class="paragraph">
<p>Log4j Docker provides access to the following container attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 80%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>containerId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The full id assigned to the container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>containerName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name assigned to the container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imageId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The id assigned to the image.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imageName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name assigned to the image.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shortContainerId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The first 12 characters of the container id.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shortImageId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The first 12 characters of the image id.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre>&lt;JsonTemplateLayout&gt;
  &lt;EventTemplateAdditionalField key="containerId" value="${docker:containerId}"/&gt;
  &lt;EventTemplateAdditionalField key="containerName" value="${docker:containerName}"/&gt;
  &lt;EventTemplateAdditionalField key="imageName" value="${docker:imageName}"/&gt;
&lt;/JsonTemplateLayout&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This Lookup is subject to the requirements listed at <a href="../log4j-docker/index.html">Log4j Docker Support</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EnvironmentLookup">Environment Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The EnvironmentLookup allows systems to configure environment variables,
either in global files such as /etc/profile or in the startup scripts
for applications, and then retrieve those variables from within the
logging configuration. The example below includes the name of the
currently logged in user in the application log.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] $${env:USER} %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lookup also supports default value syntax. In the sample below,
when the <code>USER</code> environment variable is undefined, the default value
<code>jdoe</code> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] $${env:USER:-jdoe} %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EventLookup">Event Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The EventLookup provides access to fields within the log event from the configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 80%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exception</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the simple class name of the Exception, if one is included in the event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Level</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the logging Level of the event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Logger</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the name of the Logger.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Marker</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the name of the Marker associated with the log event, if one is present.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Message</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the formatted Message string.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ThreadId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the thread id associated with the log event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ThreadName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the name of the thread associate with the log event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns the time in milliseconds when the event occurred.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example the RoutingAppender picks a route based on the presence of a Marker named "AUDIT" being
present in the log event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prettyprint" data-lang="prettyprint">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="WARN" name="RoutingTest"&gt;
  &lt;Appenders&gt;
    &lt;Console name="STDOUT" target="SYSTEM_OUT" /&gt;
    &lt;Flume name="AuditLogger" compress="true"&gt;
      &lt;Agent host="192.168.10.101" port="8800"/&gt;
      &lt;Agent host="192.168.10.102" port="8800"/&gt;
      &lt;RFC5424Layout enterpriseNumber="18060" includeMDC="true" appName="MyApp"/&gt;
    &lt;/Flume&gt;
    &lt;Routing name="Routing"&gt;
      &lt;Routes&gt;
        &lt;Route pattern="$${event:Marker}"&gt;
          &lt;RollingFile
              name="Rolling-${mdc:UserId}"
              fileName="${mdc:UserId}.log"
              filePattern="${mdc:UserId}.%i.log.gz"&gt;
            &lt;PatternLayout&gt;
              &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
            &lt;/PatternLayout&gt;
            &lt;SizeBasedTriggeringPolicy size="500" /&gt;
          &lt;/RollingFile&gt;
        &lt;/Route&gt;
        &lt;Route ref="AuditLogger" key="AUDIT"/&gt;
        &lt;Route ref="STDOUT" key="STDOUT"/&gt;
      &lt;/Routes&gt;
      &lt;IdlePurgePolicy timeToLive="15" timeUnit="minutes"/&gt;
    &lt;/Routing&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Routing" /&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JavaLookup">Java Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JavaLookup allows Java environment information to be retrieved in
convenient preformatted strings using the <code>java:</code> prefix.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 80%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The short Java version, like:</p>
</div>
<div class="paragraph">
<p><code>Java version 1.7.0_67</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Java runtime version, like:</p>
</div>
<div class="paragraph">
<p><code>Java&#8482; SE Runtime Environment (build 1.7.0_67-b01) from Oracle Corporation</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vm</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Java VM version, like:</p>
</div>
<div class="paragraph">
<p><code>Java HotSpot&#8482; 64-Bit Server VM (build 24.65-b04, mixed mode)</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>os</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The OS version, like:</p>
</div>
<div class="paragraph">
<p><code>Windows 7 6.1 Service Pack 1, architecture: amd64-64</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locale</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Hardware information, like:</p>
</div>
<div class="paragraph">
<p><code>default locale: en_US, platform encoding: Cp1252</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hw</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>System locale and file encoding information, like:</p>
</div>
<div class="paragraph">
<p><code>processors: 4, architecture: amd64-64, instruction sets: amd64</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout header="${java:runtime} - ${java:vm} - ${java:os}"&gt;
    &lt;Pattern&gt;%d %m%n&lt;/Pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JndiLookup">JNDI Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As of Log4j 2.15.1 JNDI operations require that <code>log4j2.enableJndi=true</code> be set as a system property or the
corresponding environment variable for this lookup to function. See the
<a href="./configuration.html#enableJndi">log4j2.enableJndi</a> system property.</p>
</div>
<div class="paragraph">
<p>The JndiLookup allows variables to be retrieved via JNDI. By default the
key will be prefixed with java:comp/env/, however if the key contains a
":" no prefix will be added.</p>
</div>
<div class="paragraph">
<p>By default the JNDI Lookup only supports the java, ldap, and ldaps protocols or no protocol. Additional
protocols may be supported by specifying them on the <code>log4j2.allowedJndiProtocols</code> property.
When using LDAP Java classes that implement the Referenceable interface are not supported for security
reasons. Only the Java primative classes are supported by default as well as any classes specified by the
<code>log4j2.allowedLdapClasses</code> property. When using LDAP only references to the local host name
or ip address are supported along with any hosts or ip addresses listed in the
<code>log4j2.allowedLdapHosts</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] $${jndi:logging/context-name} %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java&#8217;s JNDI module is not available on Android.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JmxRuntimeInputArgumentsLookup">JVM Input Arguments Lookup (JMX)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maps JVM input arguments&#8201;&#8212;&#8201;but not <em>main</em> arguments&#8201;&#8212;&#8201;using JMX to
acquire the JVM arguments.</p>
</div>
<div class="paragraph">
<p>Use the prefix <code>jvmrunargs</code> to access JVM arguments.</p>
</div>
<div class="paragraph">
<p>See the Javadocs for
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/RuntimeMXBean.html#getInputArguments--">java.lang.management.RuntimeMXBean.getInputArguments()</a>.</p>
</div>
<div class="paragraph">
<p><strong>Java&#8217;s JMX module is not available on Android or on Google App Engine.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="KubernetesLookup">Kubernetes Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The KubernetesLookup can be used to lookup attributes from the Kubernetes environment for the container
the application is running in.</p>
</div>
<div class="paragraph">
<p>Log4j Kubernetes provides access to the following container attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 80%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Attribute</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accountName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The service account name</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clusterName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the cluster the application is deployed in</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>containerId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&gt;The full id assigned to the container</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>containerName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name assigned to the container</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name assigned to the host operating system</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hostIp</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The host&#8217;s ip address</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imageId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The id assigned to the container image</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imageName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name assigned to the container image</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>labels</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>All labels formatted in a list</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>labels.app</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The application name</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>labels.podTemplateHash</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The pod&#8217;s template hash value</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>masterUrl</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The URL used to access the API server</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespaceId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The id of the namespace the various kubernetes components are located within</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespaceName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The namespace the various kubernetes components are located within</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>podId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The pod&#8217;s ip number</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>podIp</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The pod&#8217;s ip address</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>podName</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the pod</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This Lookup is subject to the configuration requirements listed at <a href="../log4j-kubernetes/index.html">Log4j Kubernetes Support</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Log4jConfigLookup">Log4j Configuration Location Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j configuration properties. The expressions
<code>${log4j:configLocation}</code> and <code>${log4j:configParentLocation}</code>
respectively provide the absolute path to the log4j configuration file
and its parent folder.</p>
</div>
<div class="paragraph">
<p>The example below uses this lookup to place log files in a directory
relative to the log4j configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="${log4j:configParentLocation}/logs/application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="LowerLookup">Lower Lookup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The LowerLookup converts the passed in argument to lower case. Presumably the value will be the
result of a nested lookup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] $${lower:${spring:spring.application.name}} %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="AppMainArgsLookup">Main Arguments Lookup (Application)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This lookup requires that you manually provide the main arguments of the
application to Log4j:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import org.apache.logging.log4j.core.lookup.MainMapLookup;

public static void main(String args[]) {
  MainMapLookup.setMainArguments(args);
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the main arguments have been set, this lookup allows applications to
retrieve these main argument values from within the logging
configuration. The key that follows the <code>main:</code> prefix can either be a
0-based index into the argument list, or a string, where
<code>${main:myString}</code> is substituted with the value that follows <code>myString</code>
in the main argument list.</p>
</div>
<div class="paragraph">
<p>Note: Many applications use leading dashes to identify command arguments. Specifying
<code>${main:--file}</code> would result in the lookup failing because it would look for a variable
named "main" with a default value of "-file". To avoid this the ":" separating the Lookup name from the
key must be followed by a backslash as an escape character as in <code>${main:\--file}</code>.</p>
</div>
<div class="paragraph">
<p>For example, suppose the static void main String[] arguments are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>--file foo.txt --verbose -x bar</pre>
</div>
</div>
<div class="paragraph">
<p>Then the following substitutions are possible:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:0}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--file</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>foo.txt</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:3}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:4}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:\--file}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>foo.txt</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:\-x}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${main:bar}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>|${main:\--quiet:-true}
|true</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Example usage:</p>
<p class="tableblock">[source,xml]
----
&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout header="File: ${main:--file}"&gt;
    &lt;Pattern&gt;%d %m%n&lt;/Pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;
----</p>
<p class="tableblock">[#MapLookup]
== Map Lookup</p>
<p class="tableblock">The MapLookup serves several purposes.</p>
<p class="tableblock">1.  Provide the base for Properties declared in the configuration file.
2.  Retrieve values from MapMessages in LogEvents.
3.  Retrieve values set with
<a href="../log4j-core/apidocs/org/apache/logging/log4j/core/lookup/MapLookup.html#setMainArguments%28java.lang.String%5B%5D%29">MapLookup.setMainArguments(String[</a>)]</p>
<p class="tableblock">The first item simply means that the MapLookup is used to substitute
properties that are defined in the configuration file. These variables
are specified without a prefix - e.g. <code>${name}</code>. The second usage allows
a value from the current
<a href="../log4j-api/apidocs/org/apache/logging/log4j/message/MapMessage.html"><code>MapMessage</code></a>,
if one is part of the current log event, to be substituted. In the
example below the RoutingAppender will use a different
RollingFileAppender for each unique value of the key named "type" in the
MapMessage. Note that when used this way a value for "type" should be
declared in the properties declaration to provide a default value in
case the message is not a MapMessage or the MapMessage does not contain
the key. See the <a href="configuration.html#PropertySubstitution">Property
Substitution</a> section of the <a href="configuration.html">Configuration</a>
page for information on how to set the default values.</p>
<p class="tableblock">[source,xml]
----
&lt;Routing name="Routing"&gt;
  &lt;Routes pattern="{map:type}"&gt;
    &lt;Route&gt;
      &lt;RollingFile name="Rolling-${map:type}" fileName="${filename}"
                   filePattern="target/rolling1/test1-${map:type}.%i.log.gz"&gt;
        &lt;PatternLayout&gt;
          &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
        &lt;/PatternLayout&gt;
        &lt;SizeBasedTriggeringPolicy size="500" /&gt;
      &lt;/RollingFile&gt;
    &lt;/Route&gt;
  &lt;/Routes&gt;
&lt;/Routing&gt;
----</p>
<p class="tableblock">The marker lookup allows you to use markers in interesting
configurations like a routing appender. Consider the following YAML
configuration and code that logs to different files based on markers:</p>
<p class="tableblock">[source,yaml]
----
Configuration:
  status: debug</p>
<p class="tableblock">  Appenders:
    Console:
    RandomAccessFile:
      - name: SQL_APPENDER
        fileName: logs/sql.log
        PatternLayout:
          Pattern: "%d{ISO8601_BASIC} %-5level %logger{1} %X %msg%n"
      - name: PAYLOAD_APPENDER
        fileName: logs/payload.log
        PatternLayout:
          Pattern: "%d{ISO8601_BASIC} %-5level %logger{1} %X %msg%n"
      - name: PERFORMANCE_APPENDER
        fileName: logs/performance.log
        PatternLayout:
          Pattern: "%d{ISO8601_BASIC} %-5level %logger{1} %X %msg%n"</p>
<p class="tableblock">    Routing:
      name: ROUTING_APPENDER
      Routes:
        pattern: "{marker:}"
        Route:
        - key: PERFORMANCE
          ref: PERFORMANCE_APPENDER
        - key: PAYLOAD
          ref: PAYLOAD_APPENDER
        - key: SQL
          ref: SQL_APPENDER</p>
<p class="tableblock">  Loggers:
    Root:
      level: trace
      AppenderRef:
        - ref: ROUTING_APPENDER
----</p>
<p class="tableblock">[source,java]
----
public static final Marker SQL = MarkerFactory.getMarker("SQL");
public static final Marker PAYLOAD = MarkerFactory.getMarker("PAYLOAD");
public static final Marker PERFORMANCE = MarkerFactory.getMarker("PERFORMANCE");</p>
<p class="tableblock">final Logger logger = LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME);</p>
<p class="tableblock">logger.info(SQL, "Message in Sql.log");
logger.info(PAYLOAD, "Message in Payload.log");
logger.info(PERFORMANCE, "Message in Performance.log");
----</p>
<p class="tableblock">Note the key part of the configuration is <code>pattern: "{marker:}"`. This
will produce three log files, each with a log event for a specific
marker. Log4j will route the log event with the `SQL` marker to
`sql.log`, the log event with the `PAYLOAD` marker to `payload.log`, and
so on.</p>
<p class="tableblock">You can use the notation `"${marker:name}"` and `"{marker:name}"</code> to
check for the existence of a marker where <code>name</code> is the marker name. If
the marker exists, the expression returns the name, otherwise <code>null</code>.</p>
<p class="tableblock">[#StructuredDataLookup]
== Structured Data Lookup</p>
<p class="tableblock">The StructuredDataLookup is very similar to the MapLookup in that it
will retrieve values from StructuredDataMessages. In addition to the Map
values it will also return the name portion of the id (not including the
enterprise number) and the type field. The main difference between the
example below and the example for MapMessage is that the "type" is an
attribute of the
<a href="../log4j-api/apidocs/org/apache/logging/log4j/message/StructuredDataMessage.html">StructuredDataMessage</a>
while "type" would have to be an item in the Map in a MapMessage.</p>
<p class="tableblock">[source,xml]
----
&lt;Routing name="Routing"&gt;
  &lt;Routes pattern="{sd:type}"&gt;
    &lt;Route&gt;
      &lt;RollingFile name="Rolling-${sd:type}" fileName="${filename}"
                   filePattern="target/rolling1/test1-${sd:type}.%i.log.gz"&gt;
        &lt;PatternLayout&gt;
          &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
        &lt;/PatternLayout&gt;
        &lt;SizeBasedTriggeringPolicy size="500" /&gt;
      &lt;/RollingFile&gt;
    &lt;/Route&gt;
  &lt;/Routes&gt;
&lt;/Routing&gt;
----</p>
<p class="tableblock">[#SystemPropertiesLookup]
== System Properties Lookup</p>
<p class="tableblock">As it is quite common to define values inside and outside the
application by using System Properties, it is only natural that they
should be accessible via a Lookup. As system properties are often
defined outside the application it would be quite common to see
something like:</p>
<p class="tableblock">[source,xml]
----
&lt;Appenders&gt;
  &lt;File name="ApplicationLog" fileName="${sys:logPath}/app.log"/&gt;
&lt;/Appenders&gt;
----</p>
<p class="tableblock">This lookup also supports default value syntax. In the sample below,
when the `logPath` system property is undefined, the default value
`/var/logs` is used:</p>
<p class="tableblock">[source,xml]
----
&lt;Appenders&gt;
  &lt;File name="ApplicationLog" fileName="${sys:logPath:-/var/logs}/app.log"/&gt;
&lt;/Appenders&gt;
----</p>
<p class="tableblock">[#UpperLookup]
== Upper Lookup</p>
<p class="tableblock">The LowerLookup converts the passed in argument to upper case. Presumably the value will be the
result of a nested lookup.</p>
<p class="tableblock">[source,xml]
----
&lt;File name="Application" fileName="application.log"&gt;
  &lt;PatternLayout&gt;
    &lt;pattern&gt;%d %p %c{1.} [%t] {upper:{${spring:spring.application.name}} %m%n&lt;/pattern&gt;
  &lt;/PatternLayout&gt;
&lt;/File&gt;
----</p>
<p class="tableblock">[#WebLookup]
== Web Lookup</p>
<p class="tableblock">The WebLookup allows applications to retrieve variables that are
associated with the ServletContext. In addition to being able to
retrieve various fields in the ServletContext, WebLookup supports
looking up values stored as attributes or configured as initialization
parameters. The following table lists various keys that can be
retrieved:</p>
<p class="tableblock">[cols="1m,4"]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>|Key |Description</p>
</div>
<div class="paragraph">
<p>|attr.<em>name</em>
|Returns the ServletContext attribute with the specified name</p>
</div>
<div class="paragraph">
<p>|request.attr.<em>name</em>
|Returns the ServletRequest attribute with the specified name - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|header.<em>name</em>
|Returns the HttpServletRequest header with the specified name - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|cookie.<em>name</em>
|Returns the HttpServletRequest cookie with the specified name - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|header.<em>name</em>
|Returns the HttpServletRequest header with the specified name - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.<em>method</em>
|Returns the HttpServletRequest method - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.<em>uri</em>
|Returns the HttpServletRequest URI - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.<em>url</em>
|Returns the HttpServletRequest URL - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.<em>remoteAddress</em>
|Returns the HttpServletRequest remote address - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.<em>remoteHost</em>
|Returns the HttpServletRequest remote host - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.parameter.<em>name</em>
|Returns the HttpServletRequest parameter - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|request.principal
|Returns the HttpServletRequest principal name - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|session.id
|Returns the HttpSession id or null if none is started - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|session.attr.<em>name</em>
|Returns the HttpSession attribute value (using <em>toString()</em> if not null) or null if absent - requires Log4jServletFilter</p>
</div>
<div class="paragraph">
<p>|contextPath
|The context path of the web application</p>
</div>
<div class="paragraph">
<p>|contextPathName
|The first token in the context path of the web application splitting on "/" characters.</p>
</div>
<div class="paragraph">
<p>|effectiveMajorVersion
|Gets the major version of the Servlet specification that the application
represented by this ServletContext is based on.</p>
</div>
<div class="paragraph">
<p>|effectiveMinorVersion
|Gets the minor version of the Servlet specification that the application
represented by this ServletContext is based on.</p>
</div>
<div class="paragraph">
<p>|initParam.<em>name</em>
|Returns the ServletContext initialization parameter with the specified name</p>
</div>
<div class="paragraph">
<p>|majorVersion
|Returns the major version of the Servlet API that this servlet container supports.</p>
</div>
<div class="paragraph">
<p>|minorVersion
|Returns the minor version of the Servlet API that this servlet container supports.</p>
</div>
<div class="paragraph">
<p>|rootDir
|Returns the result of calling getRealPath with a value of "/".</p>
</div>
<div class="paragraph">
<p>|serverInfo
|Returns the name and version of the servlet container on which the servlet is running.</p>
</div>
<div class="paragraph">
<p>|servletContextName
|Returns the name of the web application as defined in the display-name element of the deployment descriptor</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any other key names specified will first be checked to see if a
ServletContext attribute exists with that name and then will be checked
to see if an initialization parameter of that name exists. If the key is
located then the corresponding value will be returned.</p>
<p class="tableblock">[source,xml]
----
&lt;Appenders&gt;
  &lt;File name="ApplicationLog" fileName="${web:rootDir}/app.log"/&gt;
&lt;/Appenders&gt;
----</p>
<p class="tableblock">=== Request lookups and asynchronous calls</p>
<p class="tableblock">Servlet 3.0 supports asynchronous calls, by default the request tracking - and therefore request related lookups,
will not work. To make it work you can extract the servlet context attribute <code>log4j.requestExecutor</code> which
is a <code>BiConsumer&lt;ServletRequest, Runnable&gt;</code> and call it passing the correct request and task to execute
synchronously. During this task execution the lookups will be set up properly:</p>
<p class="tableblock">[source,java]
----
@GET // example using JAX-RS asynchronous feature backed by servlet AsyncContext
public void get(@Suspended AsyncResponse response,
                @Context ServletContext context,
                @Context ServletRequest request) {
   final BiConsumer&lt;ServletRequest, Runnable&gt; log4jWrapper =
        (BiConsumer&lt;ServletRequest, Runnable&gt;) context.getAttribute("log4j.requestExecutor");
   myThreadPool.submit) &#8594; log4jWrapper.accept(request, () &#8594; response.resume(doInternalGet();
}
----</p></td>
</tr>
</tbody>
</table>
</div>
</div>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p align="center">Copyright &copy; 1999-2024 <a class="external" href="http://www.apache.org">The Apache Software Foundation</a>. All Rights Reserved.<br>
      Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
