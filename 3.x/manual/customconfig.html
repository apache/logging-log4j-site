<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from target/generated-sources/site/asciidoc/manual/customconfig.adoc at 2023-12-19
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Log4j &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://logging.apache.org" id="bannerLeft"><img src="../images/ls-logo.jpg"  alt=""/></a></div>
          <div class="pull-right"><a href="http://logging.apache.org/log4j/3.x" id="bannerRight"><img src="../images/logo.png"  alt=""/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-12-19<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.0.0-beta1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://github.com/apache/logging-log4j2" class="externalLink" title="GitHub">GitHub</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://analysis.apache.org/dashboard/index/org.apache.logging.log4j:log4j" class="externalLink" title="Sonar">Sonar</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="../../../" title="Logging Services">Logging Services</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a></li>
      <li class="pull-right"><a href="https://cwiki.apache.org/confluence/display/LOGGING/Log4j" class="externalLink" title="Logging Wiki">Logging Wiki</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/home.png" alt="Apache Log4j™ 3.x" border="0"/> Apache Log4j™ 3.x</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="../javadoc.html" title="Javadoc"><span class="none"></span>Javadoc</a></li>
    <li><a href="../maven-artifacts.html" title="Maven, Ivy, Gradle Artifacts"><span class="icon-chevron-right"></span>Maven, Ivy, Gradle Artifacts</a></li>
    <li><a href="../runtime-dependencies.html" title="Runtime Dependencies"><span class="none"></span>Runtime Dependencies</a></li>
    <li><a href="../release-notes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="../faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="../performance.html" title="Performance"><span class="icon-chevron-right"></span>Performance</a></li>
    <li><a href="../articles.html" title="Articles and Tutorials"><span class="none"></span>Articles and Tutorials</a></li>
    <li><a href="../security.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../support.html" title="Support"><span class="none"></span>Support</a></li>
    <li><a href="../thanks.html" title="Thanks"><span class="none"></span>Thanks</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/pencil.png" alt="For Contributors" border="0"/> For Contributors</li>
    <li><a href="../guidelines.html" title="Guidelines"><span class="none"></span>Guidelines</a></li>
    <li><a href="../javastyle.html" title="Style Guide"><span class="none"></span>Style Guide</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/book.png" alt="Manual" border="0"/> Manual</li>
    <li><a href="../manual/index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../manual/architecture.html" title="Architecture"><span class="none"></span>Architecture</a></li>
    <li><a href="../manual/compatibility.html" title="Log4j 1.x Compatibility"><span class="none"></span>Log4j 1.x Compatibility</a></li>
    <li><a href="../manual/migration.html" title="Log4j 1.x Migration"><span class="none"></span>Log4j 1.x Migration</a></li>
    <li><a href="../manual/api.html" title="Java API"><span class="icon-chevron-right"></span>Java API</a></li>
    <li><a href="../manual/scala-api.html" title="Scala API"><span class="none"></span>Scala API</a></li>
    <li><a href="../manual/configuration.html" title="Configuration"><span class="icon-chevron-right"></span>Configuration</a></li>
    <li><a href="../manual/usage.html" title="Usage"><span class="icon-chevron-right"></span>Usage</a></li>
    <li><a href="../manual/lookups.html" title="Lookups"><span class="icon-chevron-right"></span>Lookups</a></li>
    <li><a href="../manual/appenders.html" title="Appenders"><span class="icon-chevron-right"></span>Appenders</a></li>
    <li><a href="../manual/layouts.html" title="Layouts"><span class="icon-chevron-right"></span>Layouts</a></li>
    <li><a href="../manual/filters.html" title="Filters"><span class="icon-chevron-right"></span>Filters</a></li>
    <li><a href="../manual/async.html" title="Async Loggers"><span class="icon-chevron-right"></span>Async Loggers</a></li>
    <li><a href="../manual/garbagefree.html" title="Garbage-free Logging"><span class="icon-chevron-right"></span>Garbage-free Logging</a></li>
    <li><a href="../manual/jmx.html" title="JMX"><span class="none"></span>JMX</a></li>
    <li><a href="../manual/logsep.html" title="Logging Separation"><span class="none"></span>Logging Separation</a></li>
    <li><a href="../manual/extending.html" title="Extending Log4j"><span class="icon-chevron-right"></span>Extending Log4j</a></li>
    <li><a href="../manual/plugins.html" title="Plugins"><span class="icon-chevron-right"></span>Plugins</a></li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Programmatic Log4j Configuration</a>
     <ul class="nav nav-list">
      <li><a href="../manual/customconfig.html#ConfigurationBuilder" title="ConfigurationBuilder API"><span class="none"></span>ConfigurationBuilder API</a></li>
      <li><a href="../manual/customconfig.html#ConfigurationFactory" title="Understanding ConfigurationFactory"><span class="none"></span>Understanding ConfigurationFactory</a></li>
      <li><a href="../manual/customconfig.html#Example" title="Example"><span class="none"></span>Example</a></li>
      <li><a href="../manual/customconfig.html#Configurator" title="Using Configurator"><span class="none"></span>Using Configurator</a></li>
      <li><a href="../manual/customconfig.html#Hybrid" title="Config File and Code"><span class="none"></span>Config File and Code</a></li>
      <li><a href="../manual/customconfig.html#AddingToCurrent" title="After Initialization"><span class="none"></span>After Initialization</a></li>
      <li><a href="../manual/customconfig.html#AppendingToWritersAndOutputStreams" title="Appending to Writers & OutputStreams"><span class="none"></span>Appending to Writers & OutputStreams</a></li>
     </ul></li>
    <li><a href="../manual/customloglevels.html" title="Custom Log Levels"><span class="icon-chevron-right"></span>Custom Log Levels</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/tag.png" alt="Related Projects" border="0"/> Related Projects</li>
    <li><a href="http://logging.apache.org/log4j/scala/index.html" class="externalLink" title="Log4j-Scala"><span class="none"></span>Log4j-Scala</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/link.png" alt="Older Releases" border="0"/> Older Releases</li>
    <li><a href="http://logging.apache.org/log4j/1.2/" class="externalLink" title="Log4j 1.2 - End of Life"><span class="none"></span>Log4j 1.2 - End of Life</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.3/" class="externalLink" title="Log4j 2.3 - Java 6"><span class="none"></span>Log4j 2.3 - Java 6</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.12.1/" class="externalLink" title="Log4j 2.12.1 - Java 7"><span class="none"></span>Log4j 2.12.1 - Java 7</a></li>
    <li><a href="http://logging.apache.org/log4j/2.x/" class="externalLink" title="Log4j 2.x - Latest release for Java 8"><span class="none"></span>Log4j 2.x - Latest release for Java 8</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/layers.png" alt="Internal Components" border="0"/> Internal Components</li>
    <li><a href="../log4j-api.html" title="API"><span class="none"></span>API</a></li>
    <li><a href="../log4j-core.html" title="Implementation"><span class="none"></span>Implementation</a></li>
    <li><a href="../log4j-jcl.html" title="Commons Logging Bridge"><span class="none"></span>Commons Logging Bridge</a></li>
    <li><a href="../log4j-1.2-api.html" title="Log4j 1.2 API"><span class="none"></span>Log4j 1.2 API</a></li>
    <li><a href="../log4j-slf4j-impl.html" title="SLF4J Binding"><span class="none"></span>SLF4J Binding</a></li>
    <li><a href="../log4j-jul.html" title="JUL Adapter"><span class="none"></span>JUL Adapter</a></li>
    <li><a href="../log4j-jpl.html" title="JDK Platform Logger"><span class="none"></span>JDK Platform Logger</a></li>
    <li><a href="../log4j-to-slf4j.html" title="Log4j 2 to SLF4J Adapter"><span class="none"></span>Log4j 2 to SLF4J Adapter</a></li>
    <li><a href="../log4j-jdbc-dbcp2.html" title="JDBC Appender"><span class="none"></span>JDBC Appender</a></li>
    <li><a href="../log4j-flume-ng.html" title="Apache Flume Appender"><span class="none"></span>Apache Flume Appender</a></li>
    <li><a href="../log4j-appserver.html" title="Application Server Integration"><span class="none"></span>Application Server Integration</a></li>
    <li><a href="../log4j-mongodb4.html" title="MongoDB 4 appender"><span class="none"></span>MongoDB 4 appender</a></li>
    <li><a href="../log4j-iostreams.html" title="IO Streams"><span class="none"></span>IO Streams</a></li>
    <li><a href="../log4j-docker.html" title="Docker Support"><span class="none"></span>Docker Support</a></li>
    <li><a href="../log4j-kubernetes.html" title="Kubernetes Support"><span class="none"></span>Kubernetes Support</a></li>
    <li><a href="../log4j-spring-cloud-config-client.html" title="Spring Cloud Config Client"><span class="none"></span>Spring Cloud Config Client</a></li>
    <li><a href="../log4j-transform" title="Log4j Transformation Tools"><span class="none"></span>Log4j Transformation Tools</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/link.png" alt="External Components" border="0"/> External Components</li>
    <li><a href="../log4j/jakarta" title="Log4j Jakarta EE"><span class="none"></span>Log4j Jakarta EE</a></li>
    <li><a href="../log4j/jmx-gui" title="Log4j JMX GUI"><span class="none"></span>Log4j JMX GUI</a></li>
    <li><a href="../log4j/tools" title="Log4j Tools"><span class="none"></span>Log4j Tools</a></li>
    <li><a href="../log4j/transform" title="Log4j Transformation Tools"><span class="none"></span>Log4j Transformation Tools</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/info.png" alt="Project Information" border="0"/> Project Information</li>
    <li><a href="../team.html" title="Project Team"><span class="none"></span>Project Team</a></li>
    <li><a href="https://www.apache.org/licenses/LICENSE-2.0" class="externalLink" title="Project License"><span class="none"></span>Project License</a></li>
    <li><a href="https://github.com/apache/logging-log4j2/tree/main" class="externalLink" title="Source Repository"><span class="none"></span>Source Repository</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/layers.png" alt="Project Reports" border="0"/> Project Reports</li>
    <li><a href="../rat-report.html" title="RAT Report"><span class="none"></span>RAT Report</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Programmatic Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<link rel="stylesheet" type="text/css" href="../css/tables.css">
<div class="paragraph">
<p>Log4j 2 provides a few ways for applications to create their own
programmatic configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify a custom <code>ConfigurationFactory</code> to start Log4j with a
programmatic configuration</p>
</li>
<li>
<p>Use the <code>Configurator</code> to replace the configuration after Log4j started</p>
</li>
<li>
<p>Initialize Log4j with a combination of a configuration file and
programmatic configuration</p>
</li>
<li>
<p>Modify the current <code>Configuration</code> after initialization</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ConfigurationBuilder">The ConfigurationBuilder API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with release 2.4, Log4j provides a <code>ConfigurationBuilder</code> and a
set of component builders that allow a <code>Configuration</code> to be created
fairly easily. Actual configuration objects like <code>LoggerConfig</code> or
<code>Appender</code> can be unwieldy; they require a lot of knowledge about Log4j
internals which makes them difficult to work with if all you want is to
create a <code>Configuration</code>.</p>
</div>
<div class="paragraph">
<p>The new <code>ConfigurationBuilder</code> API (in the
<code>org.apache.logging.log4j.core.config.builder.api</code> package) allows users
to create Configurations in code by constructing component
<em>definitions</em>. There is no need to work directly with actual
configuration objects. Component definitions are added to the
<code>ConfigurationBuilder</code>, and once all the definitions have been collected
all the actual configuration objects (like Loggers and Appenders) are
constructed.</p>
</div>
<div class="paragraph">
<p><code>ConfigurationBuilder</code> has convenience methods for the base components
that can be configured such as Loggers, Appenders, Filter, Properties,
etc. However, Log4j 2&#8217;s plugin mechanism means that users can create any
number of custom components. As a trade-off, the <code>ConfigurationBuilder</code>
API provides only a limited number of "strongly typed" convenience
methods like <code>newLogger()</code>, <code>newLayout()</code> etc. The generic
<code>builder.newComponent()</code> method can be used if no convenience method
exists for the component you want to configure.</p>
</div>
<div class="paragraph">
<p>For example, the builder does not know what sub-components can be
configured on specific components such as the RollingFileAppender vs.
the RoutingAppender. To specify a triggering policy on a
RollingFileAppender you would use builder.newComponent().</p>
</div>
<div class="paragraph">
<p>Examples of using the <code>ConfigurationBuilder</code> API are in the sections that
follow.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ConfigurationFactory">Understanding ConfigurationFactory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During initialization, Log4j 2 will search for available
<a href="extending.html#ConfigurationFactory">ConfigurationFactories</a> and
then select the one to use. The selected <code>ConfigurationFactory</code> creates
the <code>Configuration</code> that Log4j will use. Here is how Log4j finds the
available ConfigurationFactories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A system property named <code>log4j2.configurationFactory</code> can be set
with the name of the ConfigurationFactory to be used.</p>
</li>
<li>
<p><code>ConfigurationFactory.setConfigurationFactory(ConfigurationFactory)</code>
can be called with the instance of the <code>ConfigurationFactory</code> to be used.
This must be called before any other calls to Log4j.</p>
</li>
<li>
<p>A <code>ConfigurationFactory</code> implementation can be added to the classpath
and configured as a plugin in the "ConfigurationFactory" category. The
<code>@Order</code> annotation can be used to specify the relative priority when
multiple applicable ConfigurationFactories are found.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ConfigurationFactories have the concept of "supported types", which
basically maps to the file extension of the configuration file that the
ConfigurationFactory can handle. If a configuration file location is
specified, ConfigurationFactories whose supported type does not include
"*" or the matching file extension will not be used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Example">Initialize Log4j Using ConfigurationBuilder with a Custom ConfigurationFactory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One way to programmatically configure Log4j 2 is to create a custom
<code>ConfigurationFactory</code> that uses the
<a href="#ConfigurationBuilder"><code>ConfigurationBuilder</code></a> to create a
Configuration. The below example overrides the <code>getConfiguration()</code>
method to return a <code>Configuration</code> created by the <code>ConfigurationBuilder</code>.
This will cause the <code>Configuration</code> to automatically be hooked into Log4j
when the <code>LoggerContext</code> is created. In the example below, because it
specifies a supported type of "*" it will override any configuration
files provided.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Namespace(ConfigurationFactory.NAMESPACE)
@Plugin
@Order(50)
public class CustomConfigurationFactory extends ConfigurationFactory {

    static Configuration createConfiguration(final String name, ConfigurationBuilder&lt;BuiltConfiguration&gt; builder) {
        builder.setConfigurationName(name);
        builder.setStatusLevel(Level.ERROR);
        builder.add(builder.newFilter("ThresholdFilter", Filter.Result.ACCEPT, Filter.Result.NEUTRAL).
            addAttribute("level", Level.DEBUG));
        AppenderComponentBuilder appenderBuilder = builder.newAppender("Stdout", "CONSOLE").
            addAttribute("target", ConsoleAppender.Target.SYSTEM_OUT);
        appenderBuilder.add(builder.newLayout("PatternLayout").
            addAttribute("pattern", "%d [%t] %-5level: %msg%n%throwable"));
        appenderBuilder.add(builder.newFilter("MarkerFilter", Filter.Result.DENY,
            Filter.Result.NEUTRAL).addAttribute("marker", "FLOW"));
        builder.add(appenderBuilder);
        builder.add(builder.newLogger("org.apache.logging.log4j", Level.DEBUG).
            add(builder.newAppenderRef("Stdout")).
            addAttribute("additivity", false));
        builder.add(builder.newRootLogger(Level.ERROR).add(builder.newAppenderRef("Stdout")));
        return builder.build();
    }

    @Override
    public Configuration getConfiguration(final LoggerContext loggerContext, final ConfigurationSource source) {
        return getConfiguration(loggerContext, source.toString(), null);
    }

    @Override
    public Configuration getConfiguration(final LoggerContext loggerContext, final String name, final URI configLocation) {
        ConfigurationBuilder&lt;BuiltConfiguration&gt; builder = newConfigurationBuilder();
        return createConfiguration(name, builder);
    }

    @Override
    protected String[] getSupportedTypes() {
        return new String[] {"*"};
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As of version 2.7, the <code>ConfigurationFactory.getConfiguration()</code> methods
take an additional <code>LoggerContext</code> parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configurator">Reconfigure Log4j Using ConfigurationBuilder with the Configurator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An alternative to a custom <code>ConfigurationFactory</code> is to configure with the
<code>Configurator</code>. Once a <code>Configuration</code> object has been constructed, it can
be passed to one of the <code>Configurator.initialize</code> methods to set up the
Log4j configuration.</p>
</div>
<div class="paragraph">
<p>Using the <code>Configurator</code> in this manner allows the application control
over when Log4j is initialized. However, should any logging be attempted
before <code>Configurator.initialize()</code> is called then the default
configuration will be used for those log events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ConfigurationBuilder&lt;BuiltConfiguration&gt; builder = ConfigurationBuilderFactory.newConfigurationBuilder();
builder.setStatusLevel(Level.ERROR);
builder.setConfigurationName("BuilderTest");
builder.add(builder.newFilter("ThresholdFilter", Filter.Result.ACCEPT, Filter.Result.NEUTRAL)
    .addAttribute("level", Level.DEBUG));
AppenderComponentBuilder appenderBuilder = builder.newAppender("Stdout", "CONSOLE").addAttribute("target",
    ConsoleAppender.Target.SYSTEM_OUT);
appenderBuilder.add(builder.newLayout("PatternLayout")
    .addAttribute("pattern", "%d [%t] %-5level: %msg%n%throwable"));
appenderBuilder.add(builder.newFilter("MarkerFilter", Filter.Result.DENY, Filter.Result.NEUTRAL)
    .addAttribute("marker", "FLOW"));
builder.add(appenderBuilder);
builder.add(builder.newLogger("org.apache.logging.log4j", Level.DEBUG)
    .add(builder.newAppenderRef("Stdout")).addAttribute("additivity", false));
builder.add(builder.newRootLogger(Level.ERROR).add(builder.newAppenderRef("Stdout")));
ctx = Configurator.initialize(builder.build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how to create a configuration that includes a
RollingFileAppender.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ConfigurationBuilder&lt;BuiltConfiguration&gt; builder = ConfigurationBuilderFactory.newConfigurationBuilder();

builder.setStatusLevel(Level.ERROR);
builder.setConfigurationName("RollingBuilder");
// create a console appender
AppenderComponentBuilder appenderBuilder = builder.newAppender("Stdout", "CONSOLE").addAttribute("target",
    ConsoleAppender.Target.SYSTEM_OUT);
appenderBuilder.add(builder.newLayout("PatternLayout")
    .addAttribute("pattern", "%d [%t] %-5level: %msg%n%throwable"));
builder.add(appenderBuilder);
// create a rolling file appender
LayoutComponentBuilder layoutBuilder = builder.newLayout("PatternLayout")
    .addAttribute("pattern", "%d [%t] %-5level: %msg%n");
ComponentBuilder triggeringPolicy = builder.newComponent("Policies")
    .addComponent(builder.newComponent("CronTriggeringPolicy").addAttribute("schedule", "0 0 0 * * ?"))
    .addComponent(builder.newComponent("SizeBasedTriggeringPolicy").addAttribute("size", "100M"));
appenderBuilder = builder.newAppender("rolling", "RollingFile")
    .addAttribute("fileName", "target/rolling.log")
    .addAttribute("filePattern", "target/archive/rolling-%d{MM-dd-yy}.log.gz")
    .add(layoutBuilder)
    .addComponent(triggeringPolicy);
builder.add(appenderBuilder);

// create the new logger
builder.add(builder.newLogger("TestLogger", Level.DEBUG)
    .add(builder.newAppenderRef("rolling"))
    .addAttribute("additivity", false));

builder.add(builder.newRootLogger(Level.DEBUG)
    .add(builder.newAppenderRef("rolling")));
LoggerContext ctx = Configurator.initialize(builder.build());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Hybrid">Initialize Log4j by Combining Configuration File with Programmatic Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes you want to configure with a configuration file but do some
additional programmatic configuration. A possible use case might be that
you want to allow for a flexible configuration using XML but at the same
time make sure there are a few configuration elements that are always
present that can&#8217;t be removed.</p>
</div>
<div class="paragraph">
<p>The easiest way to achieve this is to extend one of the standard
<code>Configuration</code> classes (<code>XMLConfiguration</code>, <code>JSONConfiguration</code>) and then
create a new <code>ConfigurationFactory</code> for the extended class. After the
standard configuration completes the custom configuration can be added
to it.</p>
</div>
<div class="paragraph">
<p>The example below shows how to extend <code>XMLConfiguration</code> to manually add
an <code>Appender</code> and a <code>LoggerConfig</code> to the configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Namespace("ConfigurationFactory")
@Plugin("MyXMLConfigurationFactory")
@Order(10)
public class MyXMLConfigurationFactory extends ConfigurationFactory {

    /**
     * Valid file extensions for XML files.
     */
    public static final String[] SUFFIXES = new String[] {".xml", "*"};

    /**
     * Return the Configuration.
     * @param source The InputSource.
     * @return The Configuration.
     */
    public Configuration getConfiguration(InputSource source) {
        return new MyXMLConfiguration(source, configFile);
    }

    /**
     * Returns the file suffixes for XML files.
     * @return An array of File extensions.
     */
    public String[] getSupportedTypes() {
        return SUFFIXES;
    }
}

public class MyXMLConfiguration extends XMLConfiguration {
    public MyXMLConfiguration(final ConfigurationFactory.ConfigurationSource configSource) {
      super(configSource);
    }

    @Override
    protected void doConfigure() {
        super.doConfigure();
        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);
        final Layout layout = PatternLayout.createDefaultLayout(config);
        final Appender appender = FileAppender.createAppender("target/test.log", "false", "false", "File", "true",
              "false", "false", "4000", layout, null, "false", null, config);
        appender.start();
        addAppender(appender);
        LoggerConfig loggerConfig = LoggerConfig.createLogger("false", "info", "org.apache.logging.log4j",
              "true", refs, null, config, null );
        loggerConfig.addAppender(appender, null, null);
        addLogger("org.apache.logging.log4j", loggerConfig);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="AddingToCurrent">Programmatically Modifying the Current Configuration after Initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications sometimes have the need to customize logging separate from
the actual configuration. Log4j allows this although it suffers from a
few limitations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the configuration file is changed the configuration will be
reloaded and the manual changes will be lost.</p>
</li>
<li>
<p>Modification to the running configuration requires that all the
methods being called (addAppender and addLogger) be synchronized.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As such, the recommended approach for customizing a configuration is to
extend one of the standard Configuration classes, override the setup
method to first do super.setup() and then add the custom Appenders,
Filters and LoggerConfigs to the configuration before it is registered
for use.</p>
</div>
<div class="paragraph">
<p>The following example adds an Appender and a new LoggerConfig using that
Appender to the current configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);
        final Configuration config = ctx.getConfiguration();
        Layout layout = PatternLayout.createDefaultLayout(config);
        Appender appender = FileAppender.createAppender("target/test.log", "false", "false", "File", "true",
            "false", "false", "4000", layout, null, "false", null, config);
        appender.start();
        config.addAppender(appender);
        AppenderRef ref = AppenderRef.createAppenderRef("File", null, null);
        AppenderRef[] refs = new AppenderRef[] {ref};
        LoggerConfig loggerConfig = LoggerConfig.createLogger("false", "info", "org.apache.logging.log4j",
            "true", refs, null, config, null );
        loggerConfig.addAppender(appender, null, null);
        config.addLogger("org.apache.logging.log4j", loggerConfig);
        ctx.updateLoggers();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="AppendingToWritersAndOutputStreams">Appending Log Events to Writers and OutputStreams Programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j 2.5 provides facilities to append log events to Writers and
OutputStreams. For example, this provides simple integration for JDBC
Driver implementors that use Log4j internally and still want to support
the JDBC APIs <code>CommonDataSource.setLogWriter(PrintWriter)</code>,
<code>java.sql.DriverManager.setLogWriter(PrintWriter)</code>, and
<code>java.sql.DriverManager.setLogStream(PrintStream)</code>.</p>
</div>
<div class="paragraph">
<p>Given any <code>Writer</code>, like a <code>PrintWriter</code>, you tell Log4j to append
events to that writer by creating a <code>WriterAppender</code> and updating the
Log4j configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void addAppender(final Writer writer, final String writerName) {
    final LoggerContext context = LoggerContext.getContext(false);
    final Configuration config = context.getConfiguration();
    final PatternLayout layout = PatternLayout.createDefaultLayout(config);
    final Appender appender = WriterAppender.createAppender(layout, null, writer, writerName, false, true);
    appender.start();
    config.addAppender(appender);
    updateLoggers(appender, config);
}

private void updateLoggers(final Appender appender, final Configuration config) {
    final Level level = null;
    final Filter filter = null;
    for (final LoggerConfig loggerConfig : config.getLoggers().values()) {
        loggerConfig.addAppender(appender, level, filter);
    }
    config.getRootLogger().addAppender(appender, level, filter);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can achieve the same effect with an <code>OutputStream</code>, like a
<code>PrintStream</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void addAppender(final OutputStream outputStream, final String outputStreamName) {
    final LoggerContext context = LoggerContext.getContext(false);
    final Configuration config = context.getConfiguration();
    final PatternLayout layout = PatternLayout.createDefaultLayout(config);
    final Appender appender = OutputStreamAppender.createAppender(layout, null, outputStream, outputStreamName, false, true);
    appender.start();
    config.addAppender(appender);
    updateLoggers(appender, config);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference is the use of <code>OutputStreamAppender</code> instead of
<code>WriterAppender</code>.</p>
</div>
</div>
</div>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p align="center">Copyright &copy; 1999-2023 <a class="external" href="http://www.apache.org">The Apache Software Foundation</a>. All Rights Reserved.<br>
      Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
