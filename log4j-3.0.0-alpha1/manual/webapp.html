<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from target/generated-sources/site/asciidoc/manual/webapp.adoc at 2023-06-17
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Log4j &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://logging.apache.org" id="bannerLeft"><img src="../images/ls-logo.jpg"  alt=""/></a></div>
          <div class="pull-right"><a href="http://logging.apache.org/log4j/3.x" id="bannerRight"><img src="../images/logo.png"  alt=""/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-06-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.0.0-alpha1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://github.com/apache/logging-log4j2" class="externalLink" title="GitHub">GitHub</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://analysis.apache.org/dashboard/index/org.apache.logging.log4j:log4j" class="externalLink" title="Sonar">Sonar</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="../../../" title="Logging Services">Logging Services</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a></li>
      <li class="pull-right"><a href="https://cwiki.apache.org/confluence/display/LOGGING/Log4j" class="externalLink" title="Logging Wiki">Logging Wiki</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/home.png" alt="Apache Log4j™ 3.x" border="0"/> Apache Log4j™ 3.x</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="../javadoc.html" title="Javadoc"><span class="none"></span>Javadoc</a></li>
    <li><a href="../maven-artifacts.html" title="Maven, Ivy, Gradle Artifacts"><span class="icon-chevron-right"></span>Maven, Ivy, Gradle Artifacts</a></li>
    <li><a href="../runtime-dependencies.html" title="Runtime Dependencies"><span class="none"></span>Runtime Dependencies</a></li>
    <li><a href="../release-notes/index.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="../faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="../performance.html" title="Performance"><span class="icon-chevron-right"></span>Performance</a></li>
    <li><a href="../articles.html" title="Articles and Tutorials"><span class="none"></span>Articles and Tutorials</a></li>
    <li><a href="../security.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../support.html" title="Support"><span class="none"></span>Support</a></li>
    <li><a href="../thanks.html" title="Thanks"><span class="none"></span>Thanks</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/pencil.png" alt="For Contributors" border="0"/> For Contributors</li>
    <li><a href="../guidelines.html" title="Guidelines"><span class="none"></span>Guidelines</a></li>
    <li><a href="../javastyle.html" title="Style Guide"><span class="none"></span>Style Guide</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/book.png" alt="Manual" border="0"/> Manual</li>
    <li><a href="../manual/index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../manual/architecture.html" title="Architecture"><span class="none"></span>Architecture</a></li>
    <li><a href="../manual/compatibility.html" title="Log4j 1.x Compatibility"><span class="none"></span>Log4j 1.x Compatibility</a></li>
    <li><a href="../manual/migration.html" title="Log4j 1.x Migration"><span class="none"></span>Log4j 1.x Migration</a></li>
    <li><a href="../manual/api.html" title="Java API"><span class="icon-chevron-right"></span>Java API</a></li>
    <li><a href="../manual/scala-api.html" title="Scala API"><span class="none"></span>Scala API</a></li>
    <li><a href="../manual/configuration.html" title="Configuration"><span class="icon-chevron-right"></span>Configuration</a></li>
    <li><a href="../manual/usage.html" title="Usage"><span class="icon-chevron-right"></span>Usage</a></li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Web Applications and JSPs</a>
     <ul class="nav nav-list">
      <li><a href="../manual/webapp.html#Servlet-3.0" title="Servlet 3.0 and Newer"><span class="none"></span>Servlet 3.0 and Newer</a></li>
      <li><a href="../manual/webapp.html#Servlet-2.5" title="Servlet 2.5"><span class="none"></span>Servlet 2.5</a></li>
      <li><a href="../manual/webapp.html#ContextParams" title="Context Parameters"><span class="none"></span>Context Parameters</a></li>
      <li><a href="../manual/webapp.html#WebLookup" title="Configuration Lookups"><span class="none"></span>Configuration Lookups</a></li>
      <li><a href="../manual/webapp.html#JspLogging" title="JavaServer Pages Logging"><span class="none"></span>JavaServer Pages Logging</a></li>
      <li><a href="../manual/webapp.html#Async" title="Asynchronous Requests"><span class="none"></span>Asynchronous Requests</a></li>
     </ul></li>
    <li><a href="../manual/lookups.html" title="Lookups"><span class="icon-chevron-right"></span>Lookups</a></li>
    <li><a href="../manual/appenders.html" title="Appenders"><span class="icon-chevron-right"></span>Appenders</a></li>
    <li><a href="../manual/layouts.html" title="Layouts"><span class="icon-chevron-right"></span>Layouts</a></li>
    <li><a href="../manual/filters.html" title="Filters"><span class="icon-chevron-right"></span>Filters</a></li>
    <li><a href="../manual/async.html" title="Async Loggers"><span class="icon-chevron-right"></span>Async Loggers</a></li>
    <li><a href="../manual/garbagefree.html" title="Garbage-free Logging"><span class="icon-chevron-right"></span>Garbage-free Logging</a></li>
    <li><a href="../manual/jmx.html" title="JMX"><span class="none"></span>JMX</a></li>
    <li><a href="../manual/logsep.html" title="Logging Separation"><span class="none"></span>Logging Separation</a></li>
    <li><a href="../manual/extending.html" title="Extending Log4j"><span class="icon-chevron-right"></span>Extending Log4j</a></li>
    <li><a href="../manual/plugins.html" title="Plugins"><span class="icon-chevron-right"></span>Plugins</a></li>
    <li><a href="../manual/customconfig.html" title="Programmatic Log4j Configuration"><span class="icon-chevron-right"></span>Programmatic Log4j Configuration</a></li>
    <li><a href="../manual/customloglevels.html" title="Custom Log Levels"><span class="icon-chevron-right"></span>Custom Log Levels</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/tag.png" alt="Related Projects" border="0"/> Related Projects</li>
    <li><a href="http://logging.apache.org/log4j/scala/index.html" class="externalLink" title="Log4j-Scala"><span class="none"></span>Log4j-Scala</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/link.png" alt="Older Releases" border="0"/> Older Releases</li>
    <li><a href="http://logging.apache.org/log4j/1.2/" class="externalLink" title="Log4j 1.2 - End of Life"><span class="none"></span>Log4j 1.2 - End of Life</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.3/" class="externalLink" title="Log4j 2.3 - Java 6"><span class="none"></span>Log4j 2.3 - Java 6</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.12.1/" class="externalLink" title="Log4j 2.12.1 - Java 7"><span class="none"></span>Log4j 2.12.1 - Java 7</a></li>
    <li><a href="http://logging.apache.org/log4j/2.x/" class="externalLink" title="Log4j 2.x - Latest release for Java 8"><span class="none"></span>Log4j 2.x - Latest release for Java 8</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/cog.png" alt="Components" border="0"/> Components</li>
    <li><a href="../log4j-api.html" title="API"><span class="none"></span>API</a></li>
    <li><a href="../log4j-core.html" title="Implementation"><span class="none"></span>Implementation</a></li>
    <li><a href="../log4j-jcl.html" title="Commons Logging Bridge"><span class="none"></span>Commons Logging Bridge</a></li>
    <li><a href="../log4j-1.2-api.html" title="Log4j 1.2 API"><span class="none"></span>Log4j 1.2 API</a></li>
    <li><a href="../log4j-slf4j-impl.html" title="SLF4J Binding"><span class="none"></span>SLF4J Binding</a></li>
    <li><a href="../log4j-jul.html" title="JUL Adapter"><span class="none"></span>JUL Adapter</a></li>
    <li><a href="../log4j-jpl.html" title="JDK Platform Logger"><span class="none"></span>JDK Platform Logger</a></li>
    <li><a href="../log4j-to-slf4j.html" title="Log4j 2 to SLF4J Adapter"><span class="none"></span>Log4j 2 to SLF4J Adapter</a></li>
    <li><a href="../log4j-jdbc-dbcp2.html" title="JDBC Appender"><span class="none"></span>JDBC Appender</a></li>
    <li><a href="../log4j-jeromq.html" title="ZeroMQ Appender"><span class="none"></span>ZeroMQ Appender</a></li>
    <li><a href="../log4j-flume-ng.html" title="Apache Flume Appender"><span class="none"></span>Apache Flume Appender</a></li>
    <li><a href="../log4j-jms.html" title="JMS Appender"><span class="none"></span>JMS Appender</a></li>
    <li><a href="../log4j-taglib.html" title="Tag Library"><span class="none"></span>Tag Library</a></li>
    <li><a href="../log4j-jmx-gui.html" title="JMX GUI"><span class="none"></span>JMX GUI</a></li>
    <li><a href="../log4j-web.html" title="Web Application Support"><span class="none"></span>Web Application Support</a></li>
    <li><a href="../log4j-jakarta-web.html" title="Jakarta Web Application Support"><span class="none"></span>Jakarta Web Application Support</a></li>
    <li><a href="../log4j-appserver.html" title="Application Server Integration"><span class="none"></span>Application Server Integration</a></li>
    <li><a href="../log4j-couchdb.html" title="CouchDB appender"><span class="none"></span>CouchDB appender</a></li>
    <li><a href="../log4j-mongodb3.html" title="MongoDB3 appender"><span class="none"></span>MongoDB3 appender</a></li>
    <li><a href="../log4j-mongodb4.html" title="MongoDB4 appender"><span class="none"></span>MongoDB4 appender</a></li>
    <li><a href="../log4j-cassandra.html" title="Cassandra appender"><span class="none"></span>Cassandra appender</a></li>
    <li><a href="../log4j-iostreams.html" title="IO Streams"><span class="none"></span>IO Streams</a></li>
    <li><a href="../log4j-liquibase.html" title="Liquibase Binding"><span class="none"></span>Liquibase Binding</a></li>
    <li><a href="../log4j-docker.html" title="Docker Support"><span class="none"></span>Docker Support</a></li>
    <li><a href="../log4j-kubernetes.html" title="Kubernetes Support"><span class="none"></span>Kubernetes Support</a></li>
    <li><a href="../log4j-spring-boot.html" title="Log4j Spring Boot"><span class="none"></span>Log4j Spring Boot</a></li>
    <li><a href="../log4j-spring-cloud-config-client.html" title="Spring Cloud Config Client"><span class="none"></span>Spring Cloud Config Client</a></li>
    <li><a href="../log4j-transform" title="Log4j Transformation Tools"><span class="none"></span>Log4j Transformation Tools</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/info.png" alt="Project Information" border="0"/> Project Information</li>
    <li><a href="../team.html" title="Project Team"><span class="none"></span>Project Team</a></li>
    <li><a href="https://www.apache.org/licenses/LICENSE-2.0" class="externalLink" title="Project License"><span class="none"></span>Project License</a></li>
    <li><a href="https://github.com/apache/logging-log4j2/tree/main" class="externalLink" title="Source Repository"><span class="none"></span>Source Repository</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/layers.png" alt="Project Reports" border="0"/> Project Reports</li>
    <li><a href="../rat-report.html" title="RAT Report"><span class="none"></span>RAT Report</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Web Applications</h1>
<div id="preamble">
<div class="sectionbody">
<link rel="stylesheet" type="text/css" href="../css/tables.css">
</div>
</div>
<div class="sect1">
<h2 id="using_log4j_2_in_web_applications">Using Log4j 2 in Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must take particular care when using Log4j or any other logging
framework within a Java EE web application. It&#8217;s important for logging
resources to be properly cleaned up (database connections closed, files
closed, etc.) when the container shuts down or the web application is
undeployed. Because of the nature of class loaders within web
applications, Log4j resources cannot be cleaned up through normal means.
Log4j must be "started" when the web application deploys and "shut down"
when the web application undeploys. How this works varies depending on
whether your application is a <a href="#Servlet-3.0">Servlet 3.0 or newer</a> or
<a href="#Servlet-2.5">Servlet 2.5</a> web application.</p>
</div>
<div class="paragraph">
<p>Due to the namespace change from <code>javax</code> to <code>jakarta</code> you need to use
<code>log4j-jakarta-web</code> instead of <code>log4j-web</code> for Servlet 5.0 or newer.</p>
</div>
<div class="paragraph">
<p>In either case, you&#8217;ll need to add the <code>log4j-web</code> module to your
deployment as detailed in the <a href="../maven-artifacts.html">Maven, Ivy,
and Gradle Artifacts</a> manual page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To avoid problems the Log4j shutdown hook will automatically be
disabled when the log4j-web jar is included.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j allows the configuration file to be specified in web.xml using the
<code>log4jConfiguration</code> context parameter. Log4j will search for
configuration files by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a location is provided it will be searched for as a servlet
context resource. For example, if <code>log4jConfiguration</code> contains
"logging.xml" then Log4j will look for a file with that name in the root
directory of the web application.</p>
</li>
<li>
<p>If no location is defined Log4j will search for a file that starts
with "log4j2" in the WEB-INF directory. If more than one file is found,
and if a file that starts with "log4j2-name" is present, where name is
the name of the web application, then it will be used. Otherwise the
first file will be used.</p>
</li>
<li>
<p>The "normal" search sequence using the classpath and file URLs will
be used to locate the configuration file.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1 0">
<h2 id="Servlet-3">Servlet 3.0 and Newer Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Servlet 3.0 or newer web application is any <code>&lt;web-app&gt;</code> whose
<code>version</code> attribute has a value of "3.0" or higher. Of course, the
application must also be running in a compatible web container.</p>
</div>
<div class="paragraph">
<p>Some examples are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tomcat 7.0 and higher</p>
</li>
<li>
<p>GlassFish 3.0 and higher</p>
</li>
<li>
<p>JBoss 7.0 and higher</p>
</li>
<li>
<p>Oracle WebLogic 12c and higher</p>
</li>
<li>
<p>IBM WebSphere 8.0 and higher.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="the_short_story">The Short Story</h3>
<div class="paragraph">
<p>Log4j 2 "just works" in Servlet 3.0 and newer web applications. It is
capable of automatically starting when the application deploys and
shutting down when the application undeploys. Thanks to the
<a href="https://docs.oracle.com/javaee/6/api/javax/servlet/ServletContainerInitializer.html"><code>ServletContainerInitializer</code></a>
API added to Servlet 3.0, the relevant <code>Filter</code> and
<code>ServletContextListener</code> classes can be registered dynamically on web
application startup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For performance reasons, containers often ignore
certain JARs known not to contain TLDs or <code>ServletContainerInitializer</code>
and do not scan them for web-fragments and initializers. Importantly,
Tomcat 7 &lt;7.0.43 ignores all JAR files named log4j*.jar, which prevents
this feature from working. This has been fixed in Tomcat 7.0.43, Tomcat
8, and later. In Tomcat 7 &lt;7.0.43 you will need to change
<code>catalina.properties</code> and remove "log4j*.jar" from the <code>jarsToSkip</code>
property. You may need to do something similar on other containers if
they skip scanning Log4j JAR files.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="the_long_story">The Long Story</h3>
<div class="paragraph">
<p>The Log4j 2 Web JAR file is a web-fragment configured to order before
any other web fragments in your application. It contains a
<code>ServletContainerInitializer</code>
(link:../log4j-web/apidocs/org/apache/logging/log4j/web/Log4jServletContainerInitializer
.html[<code>Log4jServletContainerInitializer</code>])
that the container automatically discovers and initializes. This adds
the
<a href="../log4j-web/apidocs/org/apache/logging/log4j/web/Log4jServletContextListener.html"><code>Log4jServletContextListener</code></a>
and
<a href="../log4j-web/apidocs/org/apache/logging/log4j/web/Log4jServletFilter.html"><code>Log4jServletFilter</code></a>
to the <code>ServletContext</code>. These classes properly initialize and
deinitialize the Log4j configuration.</p>
</div>
<div class="paragraph">
<p>For some users, automatically starting Log4j is problematic or
undesirable. You can easily disable this feature using the
<code>isLog4jAutoInitializationDisabled</code> context parameter. Simply add it to
your deployment descriptor with the value "true" to disable
auto-initialization. You <em>must</em> define the context parameter in
<code>web.xml</code>. If you set in programmatically, it will be too late for Log4j
to detect the setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;isLog4jAutoInitializationDisabled&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you disable auto-initialization, you must initialize Log4j as you
would a <a href="#Servlet-2.5">Servlet 2.5 web application</a>. You must do so
in a way that this initialization happens before any other application
code (such as Spring Framework startup code) executes.</p>
</div>
<div class="paragraph">
<p>You can customize the behavior of the listener and filter using the
<code>log4jContextName</code>, <code>log4jConfiguration</code>, and/or
<code>isLog4jContextSelectorNamed</code> context parameters. Read more about this
in the <a href="#ContextParams">Context Parameters</a> section below. You <em>must
not</em> manually configure the <code>Log4jServletContextListener</code> or
<code>Log4jServletFilter</code> in your deployment descriptor (<code>web.xml</code>) or in
another initializer or listener in a Servlet 3.0 or newer application
<em>unless you disable auto-initialization</em> with
<code>isLog4jAutoInitializationDisabled</code>. Doing so will result in startup
errors and unspecified erroneous behavior.</p>
</div>
</div>
</div>
</div>
<div class="sect1 5">
<h2 id="Servlet-2">Servlet 2.5 Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Servlet 2.5 web application is any <code>&lt;web-app&gt;</code> whose <code>version</code>
attribute has a value of "2.5." The <code>version</code> attribute is the only
thing that matters; even if the web application is running in a Servlet
3.0 or newer container, it is a Servlet 2.5 web application if the
<code>version</code> attribute is "2.5." Note that Log4j 2 does not support Servlet
2.4 and older web applications.</p>
</div>
<div class="paragraph">
<p>If you are using Log4j in a Servlet 2.5 web application, or if you have
disabled auto-initialization with the
<code>isLog4jAutoInitializationDisabled</code> context parameter, you <em>must</em>
configure the
<a href="../log4j-web/apidocs/org/apache/logging/log4j/web/Log4jServletContextListener.html"><code>Log4jServletContextListener</code></a>
and
<a href="../log4j-web/apidocs/org/apache/logging/log4j/web/Log4jServletFilter.html"><code>Log4jServletFilter</code></a>
in the deployment descriptor or programmatically. The filter should
match all requests of any type. The listener should be the very first
listener defined in your application, and the filter should be the very
first filter defined and mapped in your application. This is easily
accomplished using the following <code>web.xml</code> code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;listener&gt;
    &lt;listener-class&gt;org.apache.logging.log4j.web.Log4jServletContextListener&lt;/listener-class&gt;
&lt;/listener&gt;

&lt;filter&gt;
    &lt;filter-name&gt;log4jServletFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.apache.logging.log4j.web.Log4jServletFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;log4jServletFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
    &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
    &lt;dispatcher&gt;ASYNC&lt;/dispatcher&gt;&lt;!-- Servlet 3.0 w/ disabled auto-initialization only; not supported in 2.5 --&gt;
&lt;/filter-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can customize the behavior of the listener and filter using the
<code>log4jContextName</code>, <code>log4jConfiguration</code>, and/or
<code>isLog4jContextSelectorNamed</code> context parameters. Read more about this
in the <a href="#ContextParams">Context Parameters</a> section below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ContextParams">Context Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Log4j 2 uses the <code>ServletContext&#8217;s
<a href="https://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html#getServletContextName()">context
name</a> as the `LoggerContext</code> name and uses the standard pattern for
locating the Log4j configuration file. There are three context
parameters that you can use to control this behavior. The first,
<code>isLog4jContextSelectorNamed</code>, specifies whether the context should be
selected using the
<a href="../log4j-core/apidocs/org/apache/logging/log4j/core/selector/JndiContextSelector.html"><code>JndiContextSelector</code></a>.
If <code>isLog4jContextSelectorNamed</code> is not specified or is anything other
than <code>true</code>, it is assumed to be <code>false</code>.</p>
</div>
<div class="paragraph">
<p>If <code>isLog4jContextSelectorNamed</code> is <code>true</code>, <code>log4jContextName</code> must be
specified or <code>display-name</code> must be specified in <code>web.xml</code>; otherwise,
the application will fail to start with an exception.
<code>log4jConfiguration</code> <em>should</em> also be specified in this case, and must
be a valid URI for the configuration file; however, this parameter is
not required.</p>
</div>
<div class="paragraph">
<p>If <code>isLog4jContextSelectorNamed</code> is not <code>true</code>, <code>log4jConfiguration</code> may
optionally be specified and must be a valid URI or path to a
configuration file or start with "classpath:" to denote a configuration
file that can be found on the classpath. Without this parameter, Log4j
will use the standard mechanisms for locating the configuration file.</p>
</div>
<div class="paragraph">
<p>When specifying these context parameters, you must specify them in the
deployment descriptor (<code>web.xml</code>) even in a Servlet 3.0 or never
application. If you add them to the <code>ServletContext</code> within a listener,
Log4j will initialize before the context parameters are available and
they will have no effect. Here are some sample uses of these context
parameters.</p>
</div>
<div class="sect2">
<h3 id="set_the_logging_context_name_to_myapplication">Set the Logging Context Name to "myApplication"</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;log4jContextName&lt;/param-name&gt;
    &lt;param-value&gt;myApplication&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set_the_configuration_pathfileuri_to_etcmyappmylogging_xml">Set the Configuration Path/File/URI to "/etc/myApp/myLogging.xml"</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;log4jConfiguration&lt;/param-name&gt;
    &lt;param-value&gt;file:///etc/myApp/myLogging.xml&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use_the_jndicontextselector">Use the <code>JndiContextSelector</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;isLog4jContextSelectorNamed&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;context-param&gt;
    &lt;param-name&gt;log4jContextName&lt;/param-name&gt;
    &lt;param-value&gt;appWithJndiSelector&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;context-param&gt;
    &lt;param-name&gt;log4jConfiguration&lt;/param-name&gt;
    &lt;param-value&gt;file:///D:/conf/myLogging.xml&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this case you must also set the "Log4jContextSelector"
system property to
"org.apache.logging.log4j.core.selector.JndiContextSelector".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="WebLookup">Using Web Application Information During the Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may want to use information about the web application during
configuration. For example, you could embed the web application&#8217;s
context path in the name of a Rolling File Appender. See WebLookup in
<a href="./lookups.html#WebLookup">Lookups</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JspLogging">JavaServer Pages Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may use Log4j 2 within JSPs just as you would within any other Java
code. Simple obtain a <code>Logger</code> and call its methods to log events.
However, this requires you to use Java code within your JSPs, and some
development teams rightly are not comfortable with doing this. If you
have a dedicated user interface development team that is not familiar
with using Java, you may even have Java code disabled in your JSPs.</p>
</div>
<div class="paragraph">
<p>For this reason, Log4j 2 provides a JSP Tag Library that enables you to
log events without using any Java code. To read more about using this
tag library, <a href="../log4j-taglib/index.html">read the Log4j Tag Library
documentation.</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As noted above, containers often ignore certain
JARs known not to contain TLDs and do not scan them for TLD files.
Importantly, Tomcat 7 &lt;7.0.43 ignores all JAR files named log4j*.jar,
which prevents the JSP tag library from being automatically discovered.
This does not affect Tomcat 6.x and has been fixed in Tomcat 7.0.43,
Tomcat 8, and later. In Tomcat 7 &lt;7.0.43 you will need to change
<code>catalina.properties</code> and remove "log4j*.jar" from the <code>jarsToSkip</code>
property. You may need to do something similar on other containers if
they skip scanning Log4j JAR files.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Async">Asynchronous Requests and Threads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The handling of asynchronous requests is tricky, and regardless of
Servlet container version or configuration Log4j cannot handle
everything automatically. When standard requests, forwards, includes,
and error resources are processed, the <code>Log4jServletFilter</code> binds the
<code>LoggerContext</code> to the thread handling the request. After request
processing completes, the filter unbinds the <code>LoggerContext</code> from the
thread.</p>
</div>
<div class="paragraph">
<p>Similarly, when an internal request is dispatched using a
<code>javax.servlet.AsyncContext</code>, the <code>Log4jServletFilter</code> also binds the
<code>LoggerContext</code> to the thread handling the request and unbinds it when
request processing completes. However, this only happens for requests
<em>dispatched</em> through the <code>AsyncContext</code>. There are other asynchronous
activities that can take place other than internal dispatched requests.</p>
</div>
<div class="paragraph">
<p>For example, after starting an <code>AsyncContext</code> you could start up a
separate thread to process the request in the background, possibly
writing the response with the <code>ServletOutputStream</code>. Filters cannot
intercept the execution of this thread. Filters also cannot intercept
threads that you start in the background during non-asynchronous
requests. This is true whether you use a brand new thread or a thread
borrowed from a thread pool. So what can you do for these special
threads?</p>
</div>
<div class="paragraph">
<p>You may not need to do anything. If you didn&#8217;t use the
<code>isLog4jContextSelectorNamed</code> context parameter, there is no need to
bind the <code>LoggerContext</code> to the thread. Log4j can safely locate the
<code>LoggerContext</code> on its own. In these cases, the filter provides only
very modest performance gains, and only when creating new <code>Logger</code> instances.
However, if you <em>did</em> specify the <code>isLog4jContextSelectorNamed</code> context
parameter with the value "true", you will need to manually bind the
<code>LoggerContext</code> to asynchronous threads. Otherwise, Log4j will not be
able to locate it.</p>
</div>
<div class="paragraph">
<p>Thankfully, Log4j provides a simple mechanism for binding the
<code>LoggerContext</code> to asynchronous threads in these special circumstances.
The simplest way to do this is to wrap the <code>Runnable</code> instance that is
passed to the <code>AsyncContext.start()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.IOException;
import javax.servlet.AsyncContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.web.WebLoggerContextUtils;

public class TestAsyncServlet extends HttpServlet {

    @Override
    protected void doGet(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException {
        final AsyncContext asyncContext = req.startAsync();
        asyncContext.start(WebLoggerContextUtils.wrapExecutionContext(this.getServletContext(), new Runnable() {
            @Override
            public void run() {
                final Logger logger = LogManager.getLogger(TestAsyncServlet.class);
                logger.info("Hello, servlet!");
            }
        }));
    }

    @Override
    protected void doPost(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException {
        final AsyncContext asyncContext = req.startAsync();
        asyncContext.start(new Runnable() {
            @Override
            public void run() {
                final Log4jWebSupport webSupport =
                    WebLoggerContextUtils.getWebLifeCycle(TestAsyncServlet.this.getServletContext());
                webSupport.setLoggerContext();
                // do stuff
                webSupport.clearLoggerContext();
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be slightly more convenient when using Java 1.8 and lambda
functions as demonstrated below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.IOException;
import javax.servlet.AsyncContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.web.WebLoggerContextUtils;

public class TestAsyncServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        final AsyncContext asyncContext = req.startAsync();
        asyncContext.start(WebLoggerContextUtils.wrapExecutionContext(this.getServletContext(), () -&gt; {
            final Logger logger = LogManager.getLogger(TestAsyncServlet.class);
            logger.info("Hello, servlet!");
        }));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can obtain the
<a href="../log4j-web/apidocs/org/apache/logging/log4j/web/Log4jWebLifeCycle.html"><code>Log4jWebLifeCycle</code></a>
instance from the <code>ServletContext</code> attributes, call its
<code>setLoggerContext</code> method as the very first line of code in your
asynchronous thread, and call its <code>clearLoggerContext</code> method as the
very last line of code in your asynchronous thread. The following code
demonstrates this. It uses the container thread pool to execute
asynchronous request processing, passing an anonymous inner <code>Runnable</code>
to the <code>start</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.IOException;
import javax.servlet.AsyncContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.web.Log4jWebLifeCycle;
import org.apache.logging.log4j.web.WebLoggerContextUtils;

public class TestAsyncServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
         final AsyncContext asyncContext = req.startAsync();
        asyncContext.start(new Runnable() {
            @Override
            public void run() {
                final Log4jWebLifeCycle webLifeCycle =
                    WebLoggerContextUtils.getWebLifeCycle(TestAsyncServlet.this.getServletContext());
                webLifeCycle.setLoggerContext();
                try {
                    final Logger logger = LogManager.getLogger(TestAsyncServlet.class);
                    logger.info("Hello, servlet!");
                } finally {
                    webLifeCycle.clearLoggerContext();
                }
            }
        });
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you <em>must</em> call <code>clearLoggerContext</code> once your thread is
finished processing. Failing to do so will result in memory leaks. If
using a thread pool, it can even disrupt the logging of other web
applications in your container. For that reason, the example here shows
clearing the context in a <code>finally</code> block, which will always execute.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using_the_servlet_appender">Using the Servlet Appender</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j provides a Servlet Appender that uses the servlet context as the
log target. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Configuration status="WARN" name="ServletTest"&gt;

    &lt;Appenders&gt;
        &lt;Servlet name="Servlet"&gt;
            &lt;PatternLayout pattern="%m%n%ex{none}"/&gt;
        &lt;/Servlet&gt;
    &lt;/Appenders&gt;

    &lt;Loggers&gt;
        &lt;Root level="debug"&gt;
            &lt;AppenderRef ref="Servlet"/&gt;
        &lt;/Root&gt;
    &lt;/Loggers&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid double logging of exceptions to the servlet context, you must
use <code>%ex{none}</code> in your <code>PatternLayout</code> as shown in the example. The
exception will be omitted from the message text but it is passed to the
servlet context as the actual <code>Throwable</code> object.</p>
</div>
</div>
</div>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p align="center">Copyright &copy; 1999-2023 <a class="external" href="http://www.apache.org">The Apache Software Foundation</a>. All Rights Reserved.<br>
      Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
