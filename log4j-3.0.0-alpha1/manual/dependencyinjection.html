<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from target/generated-sources/site/asciidoc/manual/dependencyinjection.adoc at 2023-06-03
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Log4j &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://logging.apache.org" id="bannerLeft"><img src="../images/ls-logo.jpg"  alt=""/></a></div>
          <div class="pull-right"><a href="http://logging.apache.org/log4j/3.x" id="bannerRight"><img src="../images/logo.png"  alt=""/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-06-03<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.0.0-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://github.com/apache/logging-log4j2" class="externalLink" title="GitHub">GitHub</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://analysis.apache.org/dashboard/index/org.apache.logging.log4j:log4j" class="externalLink" title="Sonar">Sonar</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="../../../" title="Logging Services">Logging Services</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a></li>
      <li class="pull-right"><a href="https://cwiki.apache.org/confluence/display/LOGGING/Log4j" class="externalLink" title="Logging Wiki">Logging Wiki</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/home.png" alt="Apache Log4j™ 3.x" border="0"/> Apache Log4j™ 3.x</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="../javadoc.html" title="Javadoc"><span class="none"></span>Javadoc</a></li>
    <li><a href="../maven-artifacts.html" title="Maven, Ivy, Gradle Artifacts"><span class="icon-chevron-right"></span>Maven, Ivy, Gradle Artifacts</a></li>
    <li><a href="../runtime-dependencies.html" title="Runtime Dependencies"><span class="none"></span>Runtime Dependencies</a></li>
    <li><a href="../release-notes/" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="../faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="../performance.html" title="Performance"><span class="icon-chevron-right"></span>Performance</a></li>
    <li><a href="../articles.html" title="Articles and Tutorials"><span class="none"></span>Articles and Tutorials</a></li>
    <li><a href="../security.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../support.html" title="Support"><span class="none"></span>Support</a></li>
    <li><a href="../thanks.html" title="Thanks"><span class="none"></span>Thanks</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/pencil.png" alt="For Contributors" border="0"/> For Contributors</li>
    <li><a href="../guidelines.html" title="Guidelines"><span class="none"></span>Guidelines</a></li>
    <li><a href="../javastyle.html" title="Style Guide"><span class="none"></span>Style Guide</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/book.png" alt="Manual" border="0"/> Manual</li>
    <li><a href="../manual/index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../manual/architecture.html" title="Architecture"><span class="none"></span>Architecture</a></li>
    <li><a href="../manual/compatibility.html" title="Log4j 1.x Compatibility"><span class="none"></span>Log4j 1.x Compatibility</a></li>
    <li><a href="../manual/migration.html" title="Log4j 1.x Migration"><span class="none"></span>Log4j 1.x Migration</a></li>
    <li><a href="../manual/api.html" title="Java API"><span class="icon-chevron-right"></span>Java API</a></li>
    <li><a href="../manual/scala-api.html" title="Scala API"><span class="none"></span>Scala API</a></li>
    <li><a href="../manual/configuration.html" title="Configuration"><span class="icon-chevron-right"></span>Configuration</a></li>
    <li><a href="../manual/usage.html" title="Usage"><span class="icon-chevron-right"></span>Usage</a></li>
    <li><a href="../manual/webapp.html" title="Web Applications and JSPs"><span class="icon-chevron-right"></span>Web Applications and JSPs</a></li>
    <li><a href="../manual/lookups.html" title="Lookups"><span class="icon-chevron-right"></span>Lookups</a></li>
    <li><a href="../manual/appenders.html" title="Appenders"><span class="icon-chevron-right"></span>Appenders</a></li>
    <li><a href="../manual/layouts.html" title="Layouts"><span class="icon-chevron-right"></span>Layouts</a></li>
    <li><a href="../manual/filters.html" title="Filters"><span class="icon-chevron-right"></span>Filters</a></li>
    <li><a href="../manual/async.html" title="Async Loggers"><span class="icon-chevron-right"></span>Async Loggers</a></li>
    <li><a href="../manual/garbagefree.html" title="Garbage-free Logging"><span class="icon-chevron-right"></span>Garbage-free Logging</a></li>
    <li><a href="../manual/jmx.html" title="JMX"><span class="none"></span>JMX</a></li>
    <li><a href="../manual/logsep.html" title="Logging Separation"><span class="none"></span>Logging Separation</a></li>
    <li><a href="../manual/extending.html" title="Extending Log4j"><span class="icon-chevron-right"></span>Extending Log4j</a></li>
    <li><a href="../manual/plugins.html" title="Plugins"><span class="icon-chevron-right"></span>Plugins</a></li>
    <li><a href="../manual/customconfig.html" title="Programmatic Log4j Configuration"><span class="icon-chevron-right"></span>Programmatic Log4j Configuration</a></li>
    <li><a href="../manual/customloglevels.html" title="Custom Log Levels"><span class="icon-chevron-right"></span>Custom Log Levels</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/tag.png" alt="Related Projects" border="0"/> Related Projects</li>
    <li><a href="http://logging.apache.org/log4j/scala/index.html" class="externalLink" title="Log4j-Scala"><span class="none"></span>Log4j-Scala</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/link.png" alt="Legacy" border="0"/> Legacy</li>
    <li><a href="http://logging.apache.org/log4j/1.2/" class="externalLink" title="Log4j 1.2 - End of Life"><span class="none"></span>Log4j 1.2 - End of Life</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.3/" class="externalLink" title="Log4j 2.3 - Java 6"><span class="none"></span>Log4j 2.3 - Java 6</a></li>
    <li><a href="http://logging.apache.org/log4j/log4j-2.12.1/" class="externalLink" title="Log4j 2.12.1 - Java 7"><span class="none"></span>Log4j 2.12.1 - Java 7</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/cog.png" alt="Components" border="0"/> Components</li>
    <li><a href="../log4j-api.html" title="API"><span class="none"></span>API</a></li>
    <li><a href="../log4j-core.html" title="Implementation"><span class="none"></span>Implementation</a></li>
    <li><a href="../log4j-jcl.html" title="Commons Logging Bridge"><span class="none"></span>Commons Logging Bridge</a></li>
    <li><a href="../log4j-1.2-api.html" title="Log4j 1.2 API"><span class="none"></span>Log4j 1.2 API</a></li>
    <li><a href="../log4j-slf4j-impl.html" title="SLF4J Binding"><span class="none"></span>SLF4J Binding</a></li>
    <li><a href="../log4j-jul.html" title="JUL Adapter"><span class="none"></span>JUL Adapter</a></li>
    <li><a href="../log4j-jpl.html" title="JDK Platform Logger"><span class="none"></span>JDK Platform Logger</a></li>
    <li><a href="../log4j-to-slf4j.html" title="Log4j 2 to SLF4J Adapter"><span class="none"></span>Log4j 2 to SLF4J Adapter</a></li>
    <li><a href="../log4j-jdbc-dbcp2.html" title="JDBC Appender"><span class="none"></span>JDBC Appender</a></li>
    <li><a href="../log4j-jeromq.html" title="ZeroMQ Appender"><span class="none"></span>ZeroMQ Appender</a></li>
    <li><a href="../log4j-flume-ng.html" title="Apache Flume Appender"><span class="none"></span>Apache Flume Appender</a></li>
    <li><a href="../log4j-jms.html" title="JMS Appender"><span class="none"></span>JMS Appender</a></li>
    <li><a href="../log4j-taglib.html" title="Tag Library"><span class="none"></span>Tag Library</a></li>
    <li><a href="../log4j-jmx-gui.html" title="JMX GUI"><span class="none"></span>JMX GUI</a></li>
    <li><a href="../log4j-web.html" title="Web Application Support"><span class="none"></span>Web Application Support</a></li>
    <li><a href="../log4j-jakarta-web.html" title="Jakarta Web Application Support"><span class="none"></span>Jakarta Web Application Support</a></li>
    <li><a href="../log4j-appserver.html" title="Application Server Integration"><span class="none"></span>Application Server Integration</a></li>
    <li><a href="../log4j-couchdb.html" title="CouchDB appender"><span class="none"></span>CouchDB appender</a></li>
    <li><a href="../log4j-mongodb3.html" title="MongoDB3 appender"><span class="none"></span>MongoDB3 appender</a></li>
    <li><a href="../log4j-mongodb4.html" title="MongoDB4 appender"><span class="none"></span>MongoDB4 appender</a></li>
    <li><a href="../log4j-cassandra.html" title="Cassandra appender"><span class="none"></span>Cassandra appender</a></li>
    <li><a href="../log4j-iostreams.html" title="IO Streams"><span class="none"></span>IO Streams</a></li>
    <li><a href="../log4j-liquibase.html" title="Liquibase Binding"><span class="none"></span>Liquibase Binding</a></li>
    <li><a href="../log4j-docker.html" title="Docker Support"><span class="none"></span>Docker Support</a></li>
    <li><a href="../log4j-kubernetes.html" title="Kubernetes Support"><span class="none"></span>Kubernetes Support</a></li>
    <li><a href="../log4j-spring-boot.html" title="Log4j Spring Boot"><span class="none"></span>Log4j Spring Boot</a></li>
    <li><a href="../log4j-spring-cloud-config-client.html" title="Spring Cloud Config Client"><span class="none"></span>Spring Cloud Config Client</a></li>
    <li><a href="../log4j-transform" title="Log4j Transformation Tools"><span class="none"></span>Log4j Transformation Tools</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/info.png" alt="Project Information" border="0"/> Project Information</li>
    <li><a href="../team.html" title="Project Team"><span class="none"></span>Project Team</a></li>
    <li><a href="https://www.apache.org/licenses/LICENSE-2.0" class="externalLink" title="Project License"><span class="none"></span>Project License</a></li>
    <li><a href="https://github.com/apache/logging-log4j2/tree/main" class="externalLink" title="Source Repository"><span class="none"></span>Source Repository</a></li>
   <li class="nav-header"><img class="imageLink" src="../img/glyphicons/layers.png" alt="Project Reports" border="0"/> Project Reports</li>
    <li><a href="../rat-report.html" title="RAT Report"><span class="none"></span>RAT Report</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Dependency Injection</h1>
<div id="preamble">
<div class="sectionbody">
<link rel="stylesheet" type="text/css" href="../css/tables.css">
<div class="paragraph">
<p>Log4j 3.x uses a more sophisticated dependency injection API inspired by <a href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/package-summary.html"><code>javax.inject</code></a> and its open source implementations such as <a href="https://github.com/zsoltherpai/feather">Feather</a> and <a href="https://github.com/google/guice">Guice</a>.
Dependency injection can be thought of as a replacement for calling <code>new</code> or custom factory methods in Java code; alternatively, it can be thought of as a factory for factory instances.
Classes define <em>injection points</em> which may be fields, method parameters, and constructor parameters, whose values are injected at runtime.
Classes may define <em>factory methods</em> which provide a way to create instances of their return type while allowing for dependency injection of the factory method&#8217;s arguments.
Injector callback services may be registered for customizing the dependency injection system at initialization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>org.apache.logging.log4j.plugins.di.Injector</code> runtime keeps a registry of bindings between <code>Key&lt;T&gt;</code> and <code>Supplier&lt;T&gt;</code>, where <code>org.apache.logging.log4j.plugins.di.Key&lt;T&gt;</code> describes an instance type <code>T</code>, optional qualifier annotation type, and optional name plus namespace, and  <code>java.util.function.Supplier&lt;T&gt;</code> defines a factory for obtaining instances of <code>T</code> matching the corresponding <code>Key&lt;T&gt;</code>.
To obtain a factory for a given key, if a binding is not already registered for said key, then the raw class of the key (i.e., the <code>Class&lt;T&gt;</code> instance from <code>Key&lt;T&gt;</code>) is checked for a single constructor annotated with <code>@org.apache.logging.log4j.plugins.Inject</code> or a no-arg constructor if no <code>@Inject</code> constructor is present.
The injectable constructor is invoked with arguments which are obtained by looking up factories matching the <code>Key&lt;?&gt;</code> of each constructor parameter.
Then, fields that are annotated with <code>@Inject</code> or annotated with an annotation that is itself annotated with <code>@QualifierType</code> (i.e., a <em>qualifier annotation</em>) are injected from factories matching the <code>Key&lt;?&gt;</code> of the field.
Next, methods that are annotated with <code>@Inject</code> or have a parameter annotated with a qualifier annotation are invoked using factories matching the <code>Key&lt;?&gt;</code> of each parameter.
Finally, no-arg methods annotated with <code>@Inject</code> are invoked which can be useful for post-injection initialization logic.</p>
</div>
<div class="paragraph">
<p>Bindings may be registered using <code>Injector::registerBinding</code> or <code>Injector::registerBindingIfAbsent</code> using explicit <code>Key&lt;T&gt;</code> instances, or they may be registered using <code>Injector::registerBundle</code> as <em>bundles</em> which are instances or injectable <code>Class&lt;T&gt;</code> instances that contain one or more annotated factory methods.
Annotated factory methods are non-abstract methods annotated with an annotation that is itself annotated with <code>@org.apache.logging.log4j.plugins.FactoryType</code>.
Built-in factory annotations include <code>@org.apache.logging.log4j.plugins.Factory</code> and <code>@org.apache.logging.log4j.plugins.PluginFactory</code>.</p>
</div>
<div class="paragraph">
<p><code>Injector</code> can create <code>@Configurable</code> namespace plugins from a tree of <code>org.apache.logging.log4j.plugins.Node</code> instances using <code>Injector::configure</code>.
This allows for node attributes and child nodes to be injected into a plugin class along with any other registered bindings.
To configure a <code>Node</code>, its plugin class is checked for a static method annotated with a factory annotation (such as <code>@PluginFactory</code> or <code>@Factory</code>) first before falling back to checking for an <code>@Inject</code> constructor or a no-args constructor.
This static factory method or constructor has its parameters injected.
If the return value of a static plugin factory method implements <code>java.util.function.Supplier</code>, then member injection is performed on the instance and the return value of <code>Supplier::get</code> is returned instead.
See <a href="./plugins.html">Plugins</a> for more information.</p>
</div>
<div class="paragraph">
<p><code>Injector</code> can inject members into an arbitrary object instance by using <code>Injector::injectMembers</code>.
This can be useful for injecting Log4j-managed instances into external or application code.
An <code>Injector</code> can be obtained via <code>LoggerContext::getInjector</code>.</p>
</div>
<div class="sect2">
<h3 id="injection_points">Injection Points</h3>
<div class="paragraph">
<p>Injection points are injectable fields or parameters where a dependency should be injected.
<em>Injectable fields</em> are fields annotated with <code>@Inject</code> or a qualifier annotation.
<em>Injectable methods</em> are methods annotated with <code>@Inject</code> or are not annotated with a factory annotation and have at least one parameter annotated with a qualifier annotation.
<em>Injectable constructors</em> are constructors annotated with <code>@Inject</code>; only one such constructor should exist per class.
When a field or parameter is annotated with a name-providing annotation (i.e., an annotation annotated with <code>@org.apache.logging.log4j.plugins.name.NameProvider</code>), then the provided name or name of the field or parameter are included in the <code>Key&lt;T&gt;</code> for the injection point.
When these elements are annotated with a <code>@Namespace</code> annotation or meta-annotation, then that namespace name is included in the <code>Key&lt;T&gt;</code> for the injection point.
Similarly, when a field or parameter is annotated with a qualifier annotation, then that qualifier annotation type is included in the <code>Key&lt;T&gt;</code> for the injection point.</p>
</div>
<div class="paragraph">
<p>An example of each injection point with a no-arg <code>@Inject</code> method to show the post-injected state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class ExampleBean {
    @Override
    public String toString() {
        return "ExampleBean";
    }
}

class FieldInjection {
    @Inject
    ExampleBean exampleBean;

    @Inject
    void init() {
        System.out.println(exampleBean);
    }
}

class ConstructorInjection {
    final ExampleBean bean;

    @Inject
    ConstructorInjection(final ExampleBean exampleBean) {
        bean = exampleBean;
    }

    @Inject
    void init() {
        System.out.println(exampleBean);
    }
}

class MethodInjection {
    ExampleBean bean;

    @Inject
    void setBean(final ExampleBean exampleBean) {
        bean = exampleBean;
    }

    @Inject
    void init() {
        System.out.println(exampleBean);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="names_and_qualifiers">Names and Qualifiers</h3>
<div class="paragraph">
<p>Qualifiers are annotations that are annotated with <code>@org.apache.logging.log4j.plugins.QualifierType</code>.
Qualifiers provide a way to match dependencies and factories based on more than just their type.
For example, the <code>@org.apache.logging.log4j.plugins.Named</code> qualifier allows for creating different bindings of the same type with different names (along with support for aliases).
Qualifiers on an injection point request a binding with that qualifier type and name.
Qualifiers on a factory method register a binding with that qualifier type and name.
The name for a qualifier is provided via an <code>org.apache.logging.log4j.plugins.name.AnnotatedElementNameProvider</code> strategy class given in the <code>@NameProvider</code> annotation declared on the qualifier annotation.
Aliases are likewise provided via an <code>org.apache.logging.log4j.plugins.name.AnnotatedElementAliasesProvider</code> strategy class given in the <code>@AliasesProvider</code> annotated declared on the qualifier annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="scopes">Scopes</h3>
<div class="paragraph">
<p>Scopes control the lifecycle of instances returned from a factory.
Scopes correspond to an annotation that is annotated with <code>@org.apache.logging.log4j.plugins.ScopeType</code>.
By default, <code>@org.apache.logging.log4j.plugins.Singleton</code> and the default scope are supported.
The <code>@Singleton</code> scope ensures that only a single instance is returned from factories bound in that scope.
The default scope returns a new instance every time.
Additional scopes may be registered via <code>Injector::registerScope</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="injector_callbacks">Injector Callbacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <code>Injector</code> may be initialized with <code>org.apache.logging.log4j.plugins.di.InjectorCallback</code> service classes.
These service classes must be declared in their respective <code>module-info.java</code> files containing <code>provides org.apache.logging.log4j.plugins.di.InjectorCallback with my.fully.qualified.ClassName;</code> and should also be declared in a file named <code>META-INF/services/org.apache.logging.log4j.plugins.di.InjectorCallback</code> containing the line <code>my.fully.qualified.ClassName</code> for traditional classpath usage.
Callback services are invoked in the order defined by each <code>InjectorCallback::getOrder</code> value in the natural integer order (from <code>Integer.MIN_VALUE</code> to <code>Integer.MAX_VALUE</code>).
Each callback is given the <code>Injector</code> that invoked <code>Injector::init</code> where it can be introspected and modified.
Log4j includes one such callback with an order value of 0 which supports registering callbacks that invoke before or after this default.
This default callback registers default bindings for various keys if none are already registered.</p>
</div>
<div class="sect2">
<h3 id="configurable_bindings">Configurable Bindings</h3>
<div class="paragraph">
<p>The default callback sets up bindings for the following keys if none have been registered.
Some of these bindings were previously configured through various system properties which are supported via the default callback and its default bindings, though they can be directly registered via custom callbacks with a negative order value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.apache.logging.log4j.core.ContextDataInjector</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.config.ConfigurationFactory</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.config.composite.MergeStrategy</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.impl.LogEventFactory</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.lookup.InterpolatorFactory</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.lookup.StrSubstitutor</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.selector.ContextSelector</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.time.Clock</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.time.NanoClock</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.util.ShutdownCallbackRegistry</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.util.WatchManager</code></p>
</li>
<li>
<p><code>org.apache.logging.log4j.core.config.ConfigurationScheduler</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p align="center">Copyright &copy; 1999-2023 <a class="external" href="http://www.apache.org">The Apache Software Foundation</a>. All Rights Reserved.<br>
      Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
